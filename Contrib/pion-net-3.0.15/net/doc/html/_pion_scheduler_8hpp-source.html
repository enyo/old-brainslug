<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pion-net: common/include/pion/PionScheduler.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>common/include/pion/PionScheduler.hpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// -----------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">// pion-common: a collection of common libraries used by the Pion Platform</span>
<a name="l00003"></a>00003 <span class="comment">// -----------------------------------------------------------------------</span>
<a name="l00004"></a>00004 <span class="comment">// Copyright (C) 2007-2008 Atomic Labs, Inc.  (http://www.atomiclabs.com)</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Distributed under the Boost Software License, Version 1.0.</span>
<a name="l00007"></a>00007 <span class="comment">// See http://www.boost.org/LICENSE_1_0.txt</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#ifndef __PION_PIONSCHEDULER_HEADER__</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor">#define __PION_PIONSCHEDULER_HEADER__</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;boost/asio.hpp&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;boost/bind.hpp&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;boost/function/function0.hpp&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;boost/cstdint.hpp&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;boost/shared_ptr.hpp&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;boost/noncopyable.hpp&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;boost/thread/thread.hpp&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;boost/thread/mutex.hpp&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;boost/thread/xtime.hpp&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;boost/thread/condition.hpp&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;pion/PionConfig.hpp&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;pion/PionException.hpp&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;pion/PionLogger.hpp&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">namespace </span>pion {    <span class="comment">// begin namespace pion</span>
<a name="l00030"></a>00030 
<a name="l00034"></a><a class="code" href="classpion_1_1_pion_scheduler.html">00034</a> <span class="keyword">class </span>PION_COMMON_API PionScheduler :
<a name="l00035"></a>00035     <span class="keyword">private</span> boost::noncopyable
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037 <span class="keyword">public</span>:
<a name="l00038"></a>00038 
<a name="l00040"></a><a class="code" href="classpion_1_1_pion_scheduler.html#abf4b863df740ed21cbeca81eb949309">00040</a>     PionScheduler(<span class="keywordtype">void</span>)
<a name="l00041"></a>00041         : m_logger(PION_GET_LOGGER(<span class="stringliteral">"pion.PionScheduler"</span>)),
<a name="l00042"></a>00042         m_num_threads(DEFAULT_NUM_THREADS), m_active_users(0), m_is_running(false)
<a name="l00043"></a>00043     {}
<a name="l00044"></a>00044     
<a name="l00046"></a><a class="code" href="classpion_1_1_pion_scheduler.html#b2ea53b280ba2b5bee50ca7762c34ab6">00046</a>     <span class="keyword">virtual</span> ~PionScheduler() {}
<a name="l00047"></a>00047 
<a name="l00049"></a><a class="code" href="classpion_1_1_pion_scheduler.html#6de3810eec0bd31a4a52d3fdc1e35e77">00049</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> startup(<span class="keywordtype">void</span>) {}
<a name="l00050"></a>00050     
<a name="l00052"></a>00052     <span class="keyword">virtual</span> <span class="keywordtype">void</span> shutdown(<span class="keywordtype">void</span>);
<a name="l00053"></a>00053 
<a name="l00055"></a>00055     <span class="keywordtype">void</span> join(<span class="keywordtype">void</span>);
<a name="l00056"></a>00056     
<a name="l00060"></a>00060     <span class="keywordtype">void</span> addActiveUser(<span class="keywordtype">void</span>);
<a name="l00061"></a>00061 
<a name="l00063"></a>00063     <span class="keywordtype">void</span> removeActiveUser(<span class="keywordtype">void</span>);
<a name="l00064"></a>00064     
<a name="l00066"></a><a class="code" href="classpion_1_1_pion_scheduler.html#0d0e54bc4137e9982def1a46b12c8d23">00066</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> isRunning(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_is_running; }
<a name="l00067"></a>00067     
<a name="l00069"></a><a class="code" href="classpion_1_1_pion_scheduler.html#77a5d072acb5d6ef4a2c5c2307675c06">00069</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> setNumThreads(<span class="keyword">const</span> boost::uint32_t n) { m_num_threads = n; }
<a name="l00070"></a>00070     
<a name="l00072"></a><a class="code" href="classpion_1_1_pion_scheduler.html#52966a6e5c3d6aeb694edac2cd61f85e">00072</a>     <span class="keyword">inline</span> boost::uint32_t getNumThreads(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_num_threads; }
<a name="l00073"></a>00073 
<a name="l00075"></a><a class="code" href="classpion_1_1_pion_scheduler.html#f6854690a6dde4d634545eb0a4e7e131">00075</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> setLogger(<a class="code" href="structpion_1_1_pion_logger.html">PionLogger</a> log_ptr) { m_logger = log_ptr; }
<a name="l00076"></a>00076 
<a name="l00078"></a><a class="code" href="classpion_1_1_pion_scheduler.html#d3500a781ed003451f8bd8d735f2e6d4">00078</a>     <span class="keyword">inline</span> <a class="code" href="structpion_1_1_pion_logger.html">PionLogger</a> getLogger(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> m_logger; }
<a name="l00079"></a>00079     
<a name="l00081"></a>00081     <span class="keyword">virtual</span> boost::asio::io_service&amp; getIOService(<span class="keywordtype">void</span>) = 0;
<a name="l00082"></a>00082     
<a name="l00088"></a><a class="code" href="classpion_1_1_pion_scheduler.html#f7bd1d63ae867c8b0703ce5c10ca59db">00088</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> post(boost::function0&lt;void&gt; work_func) {
<a name="l00089"></a>00089         getIOService().post(work_func);
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091     
<a name="l00098"></a>00098     <span class="keywordtype">void</span> keepRunning(boost::asio::io_service&amp; my_service,
<a name="l00099"></a>00099                      boost::asio::deadline_timer&amp; my_timer);
<a name="l00100"></a>00100     
<a name="l00107"></a><a class="code" href="classpion_1_1_pion_scheduler.html#20d0e02515bfb301430f534592cf8dc9">00107</a>     <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> sleep(boost::uint32_t sleep_sec, boost::uint32_t sleep_nsec) {
<a name="l00108"></a>00108         boost::xtime wakeup_time(getWakeupTime(sleep_sec, sleep_nsec));
<a name="l00109"></a>00109         boost::thread::sleep(wakeup_time);
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111 
<a name="l00121"></a>00121     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> ConditionType, <span class="keyword">typename</span> LockType&gt;
<a name="l00122"></a><a class="code" href="classpion_1_1_pion_scheduler.html#de31274b6e6f1cda28307832ac5b4427">00122</a>     <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> sleep(ConditionType&amp; wakeup_condition, LockType&amp; wakeup_lock,
<a name="l00123"></a>00123                              boost::uint32_t sleep_sec, boost::uint32_t sleep_nsec)
<a name="l00124"></a>00124     {
<a name="l00125"></a>00125         boost::xtime wakeup_time(getWakeupTime(sleep_sec, sleep_nsec));
<a name="l00126"></a>00126         wakeup_condition.timed_wait(wakeup_lock, wakeup_time);
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128     
<a name="l00129"></a>00129     
<a name="l00131"></a>00131     <span class="keywordtype">void</span> processServiceWork(boost::asio::io_service&amp; service);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 <span class="keyword">protected</span>:
<a name="l00135"></a>00135 
<a name="l00144"></a>00144     <span class="keyword">static</span> boost::xtime getWakeupTime(boost::uint32_t sleep_sec,
<a name="l00145"></a>00145                                       boost::uint32_t sleep_nsec);
<a name="l00146"></a>00146 
<a name="l00148"></a><a class="code" href="classpion_1_1_pion_scheduler.html#1a75afc90ea047d950377d0755b24849">00148</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> stopServices(<span class="keywordtype">void</span>) {}
<a name="l00149"></a>00149     
<a name="l00151"></a><a class="code" href="classpion_1_1_pion_scheduler.html#58ba625f7be832dd942e3af7d05ec9fc">00151</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> stopThreads(<span class="keywordtype">void</span>) {}
<a name="l00152"></a>00152 
<a name="l00154"></a><a class="code" href="classpion_1_1_pion_scheduler.html#d2b479f2b4aecf56bee5528d0adae479">00154</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> finishServices(<span class="keywordtype">void</span>) {}
<a name="l00155"></a>00155 
<a name="l00157"></a><a class="code" href="classpion_1_1_pion_scheduler.html#d73a6044ede6a3e01e78fd5df343a52e">00157</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> finishThreads(<span class="keywordtype">void</span>) {}
<a name="l00158"></a>00158     
<a name="l00159"></a>00159     
<a name="l00161"></a><a class="code" href="classpion_1_1_pion_scheduler.html#f73bd5eb31a8c4cdd9baee96e9348fd8">00161</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t    DEFAULT_NUM_THREADS;
<a name="l00162"></a>00162 
<a name="l00164"></a><a class="code" href="classpion_1_1_pion_scheduler.html#4fa6eb8c61efa9797c4bb545ad839f2d">00164</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t    NSEC_IN_SECOND;
<a name="l00165"></a>00165 
<a name="l00167"></a><a class="code" href="classpion_1_1_pion_scheduler.html#f6bad0193b29088fe635e16cf7b29c2a">00167</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t    MICROSEC_IN_SECOND;
<a name="l00168"></a>00168     
<a name="l00170"></a><a class="code" href="classpion_1_1_pion_scheduler.html#6153b56894dac85e1512d58d888874d0">00170</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t    KEEP_RUNNING_TIMER_SECONDS;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 
<a name="l00174"></a><a class="code" href="classpion_1_1_pion_scheduler.html#de8ef55d56dc1fcf775f620022309db2">00174</a>     boost::mutex                    m_mutex;
<a name="l00175"></a>00175     
<a name="l00177"></a><a class="code" href="classpion_1_1_pion_scheduler.html#180ef006f82fccb3e95f13e515444c6e">00177</a>     <a class="code" href="structpion_1_1_pion_logger.html">PionLogger</a>                      m_logger;
<a name="l00178"></a>00178 
<a name="l00180"></a><a class="code" href="classpion_1_1_pion_scheduler.html#d8a9c61bdf7addd65bcfe0f718203a8c">00180</a>     boost::condition                m_no_more_active_users;
<a name="l00181"></a>00181 
<a name="l00183"></a><a class="code" href="classpion_1_1_pion_scheduler.html#385cac16d0f66fdad842a1b595479d27">00183</a>     boost::condition                m_scheduler_has_stopped;
<a name="l00184"></a>00184 
<a name="l00186"></a><a class="code" href="classpion_1_1_pion_scheduler.html#da8ab64e35c9205b1f95ce7f1eb44826">00186</a>     boost::uint32_t                 m_num_threads;
<a name="l00187"></a>00187 
<a name="l00189"></a><a class="code" href="classpion_1_1_pion_scheduler.html#aad4b5e970ecefea3c90f0e514b3e297">00189</a>     boost::uint32_t                 m_active_users;
<a name="l00190"></a>00190 
<a name="l00192"></a><a class="code" href="classpion_1_1_pion_scheduler.html#291dbc552d9f65c62ca362784886a4f0">00192</a>     <span class="keywordtype">bool</span>                            m_is_running;
<a name="l00193"></a>00193 };
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     
<a name="l00199"></a><a class="code" href="classpion_1_1_pion_multi_thread_scheduler.html">00199</a> <span class="keyword">class </span>PION_COMMON_API PionMultiThreadScheduler :
<a name="l00200"></a>00200     <span class="keyword">public</span> PionScheduler
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202 <span class="keyword">public</span>:
<a name="l00203"></a>00203     
<a name="l00205"></a><a class="code" href="classpion_1_1_pion_multi_thread_scheduler.html#2798b1613f9a2a7c9f7949374f45c9a8">00205</a>     PionMultiThreadScheduler(<span class="keywordtype">void</span>) {}
<a name="l00206"></a>00206     
<a name="l00208"></a><a class="code" href="classpion_1_1_pion_multi_thread_scheduler.html#fdb3d6fda339b209760a39e79b35519f">00208</a>     <span class="keyword">virtual</span> ~PionMultiThreadScheduler() {}
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     
<a name="l00211"></a>00211 <span class="keyword">protected</span>:
<a name="l00212"></a>00212     
<a name="l00214"></a><a class="code" href="classpion_1_1_pion_multi_thread_scheduler.html#4122e48ff2dff4791f6c89f8b73bcf71">00214</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> stopThreads(<span class="keywordtype">void</span>) {
<a name="l00215"></a>00215         <span class="keywordflow">if</span> (! m_thread_pool.empty()) {
<a name="l00216"></a>00216             PION_LOG_DEBUG(m_logger, <span class="stringliteral">"Waiting for threads to shutdown"</span>);
<a name="l00217"></a>00217             
<a name="l00218"></a>00218             <span class="comment">// wait until all threads in the pool have stopped</span>
<a name="l00219"></a>00219             boost::thread current_thread;
<a name="l00220"></a>00220             <span class="keywordflow">for</span> (ThreadPool::iterator i = m_thread_pool.begin();
<a name="l00221"></a>00221                  i != m_thread_pool.end(); ++i)
<a name="l00222"></a>00222             {
<a name="l00223"></a>00223                 <span class="comment">// make sure we do not call join() for the current thread,</span>
<a name="l00224"></a>00224                 <span class="comment">// since this may yield "undefined behavior"</span>
<a name="l00225"></a>00225                 <span class="keywordflow">if</span> (**i != current_thread) (*i)-&gt;join();
<a name="l00226"></a>00226             }
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229     
<a name="l00231"></a><a class="code" href="classpion_1_1_pion_multi_thread_scheduler.html#86de9ce095b810d893656d858f3f2581">00231</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> finishThreads(<span class="keywordtype">void</span>) { m_thread_pool.clear(); }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     
<a name="l00235"></a><a class="code" href="classpion_1_1_pion_multi_thread_scheduler.html#eaac2abc9b0488d97ef9a3cc68c0749c">00235</a>     <span class="keyword">typedef</span> std::vector&lt;boost::shared_ptr&lt;boost::thread&gt; &gt;  <a class="code" href="classpion_1_1_pion_multi_thread_scheduler.html#eaac2abc9b0488d97ef9a3cc68c0749c">ThreadPool</a>;
<a name="l00236"></a>00236     
<a name="l00237"></a>00237     
<a name="l00239"></a><a class="code" href="classpion_1_1_pion_multi_thread_scheduler.html#a0dad8a452d8e25474dc84098a8987cc">00239</a>     <a class="code" href="classpion_1_1_pion_multi_thread_scheduler.html#eaac2abc9b0488d97ef9a3cc68c0749c">ThreadPool</a>              m_thread_pool;
<a name="l00240"></a>00240 };
<a name="l00241"></a>00241     
<a name="l00242"></a>00242     
<a name="l00246"></a><a class="code" href="classpion_1_1_pion_single_service_scheduler.html">00246</a> <span class="keyword">class </span>PION_COMMON_API PionSingleServiceScheduler :
<a name="l00247"></a>00247     <span class="keyword">public</span> PionMultiThreadScheduler
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249 <span class="keyword">public</span>:
<a name="l00250"></a>00250     
<a name="l00252"></a><a class="code" href="classpion_1_1_pion_single_service_scheduler.html#7fb0c17c59b87087c32c16d7c38b1fed">00252</a>     PionSingleServiceScheduler(<span class="keywordtype">void</span>)
<a name="l00253"></a>00253         : m_service(), m_timer(m_service)
<a name="l00254"></a>00254     {}
<a name="l00255"></a>00255     
<a name="l00257"></a><a class="code" href="classpion_1_1_pion_single_service_scheduler.html#c70fe312a65c95d1a264e95f05533aa5">00257</a>     <span class="keyword">virtual</span> ~PionSingleServiceScheduler() { shutdown(); }
<a name="l00258"></a>00258     
<a name="l00260"></a><a class="code" href="classpion_1_1_pion_single_service_scheduler.html#06929d305e9ef4016cc86eff10b92bc5">00260</a>     <span class="keyword">virtual</span> boost::asio::io_service&amp; getIOService(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> m_service; }
<a name="l00261"></a>00261     
<a name="l00263"></a>00263     <span class="keyword">virtual</span> <span class="keywordtype">void</span> startup(<span class="keywordtype">void</span>);
<a name="l00264"></a>00264         
<a name="l00265"></a>00265     
<a name="l00266"></a>00266 <span class="keyword">protected</span>:
<a name="l00267"></a>00267     
<a name="l00269"></a><a class="code" href="classpion_1_1_pion_single_service_scheduler.html#955609daf28e2b23621002d1d5e451b2">00269</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> stopServices(<span class="keywordtype">void</span>) { m_service.stop(); }
<a name="l00270"></a>00270     
<a name="l00272"></a><a class="code" href="classpion_1_1_pion_single_service_scheduler.html#9ab49f0a970a3cc4cae42a0fd89e74aa">00272</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> finishServices(<span class="keywordtype">void</span>) { m_service.reset(); }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     
<a name="l00276"></a><a class="code" href="classpion_1_1_pion_single_service_scheduler.html#e390094bfc25b153c89030090169e86c">00276</a>     boost::asio::io_service         m_service;
<a name="l00277"></a>00277     
<a name="l00279"></a><a class="code" href="classpion_1_1_pion_single_service_scheduler.html#ec5b828f8f2ac6c8616b907c8774cd08">00279</a>     boost::asio::deadline_timer     m_timer;
<a name="l00280"></a>00280 };
<a name="l00281"></a>00281     
<a name="l00282"></a>00282 
<a name="l00286"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html">00286</a> <span class="keyword">class </span>PION_COMMON_API PionOneToOneScheduler :
<a name="l00287"></a>00287     <span class="keyword">public</span> PionMultiThreadScheduler
<a name="l00288"></a>00288 {
<a name="l00289"></a>00289 <span class="keyword">public</span>:
<a name="l00290"></a>00290     
<a name="l00292"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#5f6d4de1b6ea18278950377bf897b100">00292</a>     PionOneToOneScheduler(<span class="keywordtype">void</span>)
<a name="l00293"></a>00293         : m_service_pool(), m_next_service(0)
<a name="l00294"></a>00294     {}
<a name="l00295"></a>00295     
<a name="l00297"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#825ac196e323fc6358fc99696e22320e">00297</a>     <span class="keyword">virtual</span> ~PionOneToOneScheduler() { shutdown(); }
<a name="l00298"></a>00298     
<a name="l00300"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#ef051462da5673d923f36d0f547efb07">00300</a>     <span class="keyword">virtual</span> boost::asio::io_service&amp; getIOService(<span class="keywordtype">void</span>) {
<a name="l00301"></a>00301         boost::mutex::scoped_lock scheduler_lock(m_mutex);
<a name="l00302"></a>00302         <span class="keywordflow">while</span> (m_service_pool.size() &lt; m_num_threads) {
<a name="l00303"></a>00303             boost::shared_ptr&lt;ServicePair&gt;  service_ptr(<span class="keyword">new</span> <a class="code" href="structpion_1_1_pion_one_to_one_scheduler_1_1_service_pair.html">ServicePair</a>());
<a name="l00304"></a>00304             m_service_pool.push_back(service_ptr);
<a name="l00305"></a>00305         }
<a name="l00306"></a>00306         <span class="keywordflow">if</span> (++m_next_service &gt;= m_num_threads)
<a name="l00307"></a>00307             m_next_service = 0;
<a name="l00308"></a>00308         PION_ASSERT(m_next_service &lt; m_num_threads);
<a name="l00309"></a>00309         <span class="keywordflow">return</span> m_service_pool[m_next_service]-&gt;first;
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311     
<a name="l00318"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#a7a2513892b21fd323439cc4309039c1">00318</a>     <span class="keyword">virtual</span> boost::asio::io_service&amp; getIOService(boost::uint32_t n) {
<a name="l00319"></a>00319         PION_ASSERT(n &lt; m_num_threads);
<a name="l00320"></a>00320         PION_ASSERT(n &lt; m_service_pool.size());
<a name="l00321"></a>00321         <span class="keywordflow">return</span> m_service_pool[n]-&gt;first;
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323 
<a name="l00325"></a>00325     <span class="keyword">virtual</span> <span class="keywordtype">void</span> startup(<span class="keywordtype">void</span>);
<a name="l00326"></a>00326     
<a name="l00327"></a>00327     
<a name="l00328"></a>00328 <span class="keyword">protected</span>:
<a name="l00329"></a>00329     
<a name="l00331"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#522be0d7d4dfaedba47e67b781803410">00331</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> stopServices(<span class="keywordtype">void</span>) {
<a name="l00332"></a>00332         <span class="keywordflow">for</span> (ServicePool::iterator i = m_service_pool.begin(); i != m_service_pool.end(); ++i) {
<a name="l00333"></a>00333             (*i)-&gt;first.stop();
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335     }
<a name="l00336"></a>00336         
<a name="l00338"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#2fe653f0245dbc70d67925ab6aeed673">00338</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> finishServices(<span class="keywordtype">void</span>) { m_service_pool.clear(); }
<a name="l00339"></a>00339     
<a name="l00340"></a>00340 
<a name="l00342"></a><a class="code" href="structpion_1_1_pion_one_to_one_scheduler_1_1_service_pair.html">00342</a>     <span class="keyword">struct </span><a class="code" href="structpion_1_1_pion_one_to_one_scheduler_1_1_service_pair.html">ServicePair</a> {
<a name="l00343"></a><a class="code" href="structpion_1_1_pion_one_to_one_scheduler_1_1_service_pair.html#a202f65bbe1b376e15d6b6e13c1e3382">00343</a>         <a class="code" href="structpion_1_1_pion_one_to_one_scheduler_1_1_service_pair.html">ServicePair</a>(<span class="keywordtype">void</span>) : first(), second(first) {}
<a name="l00344"></a><a class="code" href="structpion_1_1_pion_one_to_one_scheduler_1_1_service_pair.html#50caba71bd1916e513623f39d41b81da">00344</a>         boost::asio::io_service         first;
<a name="l00345"></a><a class="code" href="structpion_1_1_pion_one_to_one_scheduler_1_1_service_pair.html#914976812387053ec880c92b4412c721">00345</a>         boost::asio::deadline_timer     second;
<a name="l00346"></a>00346     };
<a name="l00347"></a>00347     
<a name="l00349"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#dc9babc495c1b9f007b917bc2e55d25c">00349</a>     <span class="keyword">typedef</span> std::vector&lt;boost::shared_ptr&lt;ServicePair&gt; &gt;        <a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#dc9babc495c1b9f007b917bc2e55d25c">ServicePool</a>;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     
<a name="l00353"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#f8b1cf8271e272cd05d685c8c4189682">00353</a>     <a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#dc9babc495c1b9f007b917bc2e55d25c">ServicePool</a>                     m_service_pool;
<a name="l00354"></a>00354 
<a name="l00356"></a><a class="code" href="classpion_1_1_pion_one_to_one_scheduler.html#a39d30496f26e71f980972a673737660">00356</a>     boost::uint32_t                 m_next_service;
<a name="l00357"></a>00357 };
<a name="l00358"></a>00358     
<a name="l00359"></a>00359     
<a name="l00360"></a>00360 }   <span class="comment">// end namespace pion</span>
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Aug 10 15:23:13 2010 for pion-net by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
