<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pion-net: common/include/pion/PionPlugin.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>common/include/pion/PionPlugin.hpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// -----------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">// pion-common: a collection of common libraries used by the Pion Platform</span>
<a name="l00003"></a>00003 <span class="comment">// -----------------------------------------------------------------------</span>
<a name="l00004"></a>00004 <span class="comment">// Copyright (C) 2007-2008 Atomic Labs, Inc.  (http://www.atomiclabs.com)</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Distributed under the Boost Software License, Version 1.0.</span>
<a name="l00007"></a>00007 <span class="comment">// See http://www.boost.org/LICENSE_1_0.txt</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#ifndef __PION_PIONPLUGIN_HEADER__</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor">#define __PION_PIONPLUGIN_HEADER__</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;boost/thread/mutex.hpp&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;boost/filesystem/path.hpp&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;pion/PionConfig.hpp&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;pion/PionException.hpp&gt;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="keyword">namespace </span>pion {    <span class="comment">// begin namespace pion</span>
<a name="l00024"></a>00024 
<a name="l00028"></a><a class="code" href="classpion_1_1_pion_plugin.html">00028</a> <span class="keyword">class </span>PION_COMMON_API PionPlugin {
<a name="l00029"></a>00029 <span class="keyword">public</span>:
<a name="l00030"></a>00030 
<a name="l00032"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_undefined_exception.html">00032</a>     <span class="keyword">class </span><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_undefined_exception.html">PluginUndefinedException</a> : <span class="keyword">public</span> std::exception {
<a name="l00033"></a>00033     <span class="keyword">public</span>:
<a name="l00034"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_undefined_exception.html#0030863c024a20f3851ec72b9f8b01cc">00034</a>         <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* what() const throw() {
<a name="l00035"></a>00035             <span class="keywordflow">return</span> <span class="stringliteral">"Plug-in was not loaded properly"</span>;
<a name="l00036"></a>00036         }
<a name="l00037"></a>00037     };
<a name="l00038"></a>00038     
<a name="l00040"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_directory_not_found_exception.html">00040</a>     <span class="keyword">class </span><a class="code" href="classpion_1_1_pion_plugin_1_1_directory_not_found_exception.html">DirectoryNotFoundException</a> : <span class="keyword">public</span> <a class="code" href="classpion_1_1_pion_exception.html">PionException</a> {
<a name="l00041"></a>00041     <span class="keyword">public</span>:
<a name="l00042"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_directory_not_found_exception.html#ea8c1fd6aa1f5a09bdb574c8aaeb2da9">00042</a>         <a class="code" href="classpion_1_1_pion_plugin_1_1_directory_not_found_exception.html">DirectoryNotFoundException</a>(<span class="keyword">const</span> std::string&amp; dir)
<a name="l00043"></a>00043             : <a class="code" href="classpion_1_1_pion_exception.html">PionException</a>(<span class="stringliteral">"Plug-in directory not found: "</span>, dir) {}
<a name="l00044"></a>00044     };
<a name="l00045"></a>00045 
<a name="l00047"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_not_found_exception.html">00047</a>     <span class="keyword">class </span><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_not_found_exception.html">PluginNotFoundException</a> : <span class="keyword">public</span> <a class="code" href="classpion_1_1_pion_exception.html">PionException</a> {
<a name="l00048"></a>00048     <span class="keyword">public</span>:
<a name="l00049"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_not_found_exception.html#f08eca999670b7a5ba66c10faad56a9a">00049</a>         <a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_not_found_exception.html">PluginNotFoundException</a>(<span class="keyword">const</span> std::string&amp; file)
<a name="l00050"></a>00050             : <a class="code" href="classpion_1_1_pion_exception.html">PionException</a>(<span class="stringliteral">"Plug-in library not found: "</span>, file) {}
<a name="l00051"></a>00051     };
<a name="l00052"></a>00052     
<a name="l00054"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_open_plugin_exception.html">00054</a>     <span class="keyword">class </span><a class="code" href="classpion_1_1_pion_plugin_1_1_open_plugin_exception.html">OpenPluginException</a> : <span class="keyword">public</span> <a class="code" href="classpion_1_1_pion_exception.html">PionException</a> {
<a name="l00055"></a>00055     <span class="keyword">public</span>:
<a name="l00056"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_open_plugin_exception.html#0c3385a14235db6d2f36a45dda5f64db">00056</a>         <a class="code" href="classpion_1_1_pion_plugin_1_1_open_plugin_exception.html">OpenPluginException</a>(<span class="keyword">const</span> std::string&amp; file)
<a name="l00057"></a>00057             : <a class="code" href="classpion_1_1_pion_exception.html">PionException</a>(<span class="stringliteral">"Unable to open plug-in library: "</span>, file) {}
<a name="l00058"></a>00058     };
<a name="l00059"></a>00059     
<a name="l00061"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_missing_create_exception.html">00061</a>     <span class="keyword">class </span><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_missing_create_exception.html">PluginMissingCreateException</a> : <span class="keyword">public</span> <a class="code" href="classpion_1_1_pion_exception.html">PionException</a> {
<a name="l00062"></a>00062     <span class="keyword">public</span>:
<a name="l00063"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_missing_create_exception.html#bf29de75f3f607bad6ea3f93bcd0fb5c">00063</a>         <a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_missing_create_exception.html">PluginMissingCreateException</a>(<span class="keyword">const</span> std::string&amp; file)
<a name="l00064"></a>00064             : <a class="code" href="classpion_1_1_pion_exception.html">PionException</a>(<span class="stringliteral">"Plug-in library does not include create() symbol: "</span>, file) {}
<a name="l00065"></a>00065     };
<a name="l00066"></a>00066     
<a name="l00068"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_missing_destroy_exception.html">00068</a>     <span class="keyword">class </span><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_missing_destroy_exception.html">PluginMissingDestroyException</a> : <span class="keyword">public</span> <a class="code" href="classpion_1_1_pion_exception.html">PionException</a> {
<a name="l00069"></a>00069     <span class="keyword">public</span>:
<a name="l00070"></a><a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_missing_destroy_exception.html#25ef23bd609ea6d8b29efd3090ffed80">00070</a>         <a class="code" href="classpion_1_1_pion_plugin_1_1_plugin_missing_destroy_exception.html">PluginMissingDestroyException</a>(<span class="keyword">const</span> std::string&amp; file)
<a name="l00071"></a>00071             : <a class="code" href="classpion_1_1_pion_exception.html">PionException</a>(<span class="stringliteral">"Plug-in library does not include destroy() symbol: "</span>, file) {}
<a name="l00072"></a>00072     };
<a name="l00073"></a>00073 
<a name="l00081"></a><a class="code" href="classpion_1_1_pion_plugin.html#cfe519f5192e91854e6ea674976c3aa8">00081</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> findPluginFile(std::string&amp; path_to_file,
<a name="l00082"></a>00082                                       <span class="keyword">const</span> std::string&amp; name)
<a name="l00083"></a>00083     {
<a name="l00084"></a>00084         <span class="keywordflow">return</span> findFile(path_to_file, name, PION_PLUGIN_EXTENSION);
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086 
<a name="l00094"></a><a class="code" href="classpion_1_1_pion_plugin.html#5123062ec04cf007b9030dac9e30c584">00094</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> findConfigFile(std::string&amp; path_to_file,
<a name="l00095"></a>00095                                       <span class="keyword">const</span> std::string&amp; name)
<a name="l00096"></a>00096     {
<a name="l00097"></a>00097         <span class="keywordflow">return</span> findFile(path_to_file, name, PION_CONFIG_EXTENSION);
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099     
<a name="l00107"></a>00107     <span class="keyword">static</span> <span class="keywordtype">bool</span> findStaticEntryPoint(<span class="keyword">const</span> std::string&amp; plugin_name,
<a name="l00108"></a>00108                                      <span class="keywordtype">void</span> **create_func,
<a name="l00109"></a>00109                                      <span class="keywordtype">void</span> **destroy_func);
<a name="l00110"></a>00110     
<a name="l00118"></a>00118     <span class="keyword">static</span> <span class="keywordtype">void</span> addStaticEntryPoint(<span class="keyword">const</span> std::string&amp; plugin_name,
<a name="l00119"></a>00119                                     <span class="keywordtype">void</span> *create_func,
<a name="l00120"></a>00120                                     <span class="keywordtype">void</span> *destroy_func);
<a name="l00121"></a>00121     
<a name="l00130"></a>00130     <span class="keyword">static</span> <span class="keywordtype">void</span> checkCygwinPath(boost::filesystem::path&amp; final_path,
<a name="l00131"></a>00131                                 <span class="keyword">const</span> std::string&amp; path_string);
<a name="l00132"></a>00132 
<a name="l00134"></a>00134     <span class="keyword">static</span> <span class="keywordtype">void</span> addPluginDirectory(<span class="keyword">const</span> std::string&amp; dir);
<a name="l00135"></a>00135     
<a name="l00137"></a>00137     <span class="keyword">static</span> <span class="keywordtype">void</span> resetPluginDirectories(<span class="keywordtype">void</span>);
<a name="l00138"></a>00138     
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="comment">// default destructor</span>
<a name="l00141"></a><a class="code" href="classpion_1_1_pion_plugin.html#384c70afc47aea152291e5bfab5a5d38">00141</a>     <span class="keyword">virtual</span> ~PionPlugin() { releaseData(); }
<a name="l00142"></a>00142     
<a name="l00144"></a><a class="code" href="classpion_1_1_pion_plugin.html#4fdcc74131eb30a30c1f69502e0d75ea">00144</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> is_open(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (m_plugin_data != NULL); }
<a name="l00145"></a>00145     
<a name="l00147"></a><a class="code" href="classpion_1_1_pion_plugin.html#51111eacaf36dbc57fd2f8dc139ee15f">00147</a>     <span class="keyword">inline</span> std::string getPluginName(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
<a name="l00148"></a>00148         <span class="keywordflow">return</span> (is_open() ? m_plugin_data-&gt;m_plugin_name : std::string());
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150 
<a name="l00152"></a>00152     <span class="keyword">static</span> <span class="keywordtype">void</span> getAllPluginNames(std::vector&lt;std::string&gt;&amp; plugin_names);
<a name="l00153"></a>00153 
<a name="l00166"></a>00166     <span class="keywordtype">void</span> open(<span class="keyword">const</span> std::string&amp; plugin_name);
<a name="l00167"></a>00167 
<a name="l00180"></a>00180     <span class="keywordtype">void</span> openFile(<span class="keyword">const</span> std::string&amp; plugin_file);
<a name="l00181"></a>00181 
<a name="l00190"></a>00190     <span class="keywordtype">void</span> openStaticLinked(<span class="keyword">const</span> std::string&amp; plugin_name,
<a name="l00191"></a>00191                           <span class="keywordtype">void</span> *create_func,
<a name="l00192"></a>00192                           <span class="keywordtype">void</span> *destroy_func);
<a name="l00193"></a>00193 
<a name="l00195"></a><a class="code" href="classpion_1_1_pion_plugin.html#fca3fd7a1bc055ee2157601bd72ac093">00195</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> close(<span class="keywordtype">void</span>) { releaseData(); }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 <span class="keyword">protected</span>:
<a name="l00198"></a>00198     
<a name="l00202"></a><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html">00202</a>     <span class="keyword">struct </span><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html">PionPluginData</a>
<a name="l00203"></a>00203     {
<a name="l00205"></a><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html#71d9f99b010b10974e3436b7195a323f">00205</a>         <a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html">PionPluginData</a>(<span class="keywordtype">void</span>)
<a name="l00206"></a>00206             : m_lib_handle(NULL), m_create_func(NULL), m_destroy_func(NULL),
<a name="l00207"></a>00207             m_references(0)
<a name="l00208"></a>00208         {}
<a name="l00209"></a><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html#481199d8588b319f2f98c568c8d2f9a0">00209</a>         <a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html">PionPluginData</a>(<span class="keyword">const</span> std::string&amp; plugin_name)
<a name="l00210"></a>00210             : m_lib_handle(NULL), m_create_func(NULL), m_destroy_func(NULL),
<a name="l00211"></a>00211             m_plugin_name(plugin_name), m_references(0)
<a name="l00212"></a>00212         {}
<a name="l00213"></a><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html#a844e60cb688b3ee0397f49aa289b224">00213</a>         <a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html">PionPluginData</a>(<span class="keyword">const</span> <a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html">PionPluginData</a>&amp; p)
<a name="l00214"></a>00214             : m_lib_handle(p.m_lib_handle), m_create_func(p.m_create_func),
<a name="l00215"></a>00215             m_destroy_func(p.m_destroy_func), m_plugin_name(p.m_plugin_name),
<a name="l00216"></a>00216             m_references(p.m_references)
<a name="l00217"></a>00217         {}
<a name="l00218"></a>00218         
<a name="l00220"></a><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html#d1d37d3a2b594e26c832a3143c296ccf">00220</a>         <span class="keywordtype">void</span> *          m_lib_handle;
<a name="l00221"></a>00221         
<a name="l00223"></a><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html#61c3404d7239b7907833834ec5e46dd0">00223</a>         <span class="keywordtype">void</span> *          m_create_func;
<a name="l00224"></a>00224         
<a name="l00226"></a><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html#b5634c6289f8608868603a76ddb4b300">00226</a>         <span class="keywordtype">void</span> *          m_destroy_func;
<a name="l00227"></a>00227         
<a name="l00229"></a><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html#ed132387130f9a5c702e57ce1f2cd43c">00229</a>         std::string     m_plugin_name;
<a name="l00230"></a>00230         
<a name="l00232"></a><a class="code" href="structpion_1_1_pion_plugin_1_1_pion_plugin_data.html#784ecb46143e4394c4bb69aad5ed294b">00232</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   m_references;
<a name="l00233"></a>00233     };
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     
<a name="l00237"></a><a class="code" href="classpion_1_1_pion_plugin.html#0e91ec2b63fb373e90d944277a42cd73">00237</a>     PionPlugin(<span class="keywordtype">void</span>) : m_plugin_data(NULL) {}
<a name="l00238"></a>00238     
<a name="l00240"></a><a class="code" href="classpion_1_1_pion_plugin.html#9efd25ee9b773b941a1ae707c9ddc798">00240</a>     PionPlugin(<span class="keyword">const</span> PionPlugin&amp; p) : m_plugin_data(NULL) { grabData(p); }
<a name="l00241"></a>00241 
<a name="l00243"></a><a class="code" href="classpion_1_1_pion_plugin.html#79b02a58ec857bfe0ba07db8837bf7e4">00243</a>     PionPlugin&amp; operator=(<span class="keyword">const</span> PionPlugin&amp; p) { grabData(p); <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00244"></a>00244 
<a name="l00246"></a><a class="code" href="classpion_1_1_pion_plugin.html#5c6368504619782919c5771cce0af877">00246</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> *getCreateFunction(<span class="keywordtype">void</span>) {
<a name="l00247"></a>00247         <span class="keywordflow">return</span> (is_open() ? m_plugin_data-&gt;m_create_func : NULL);
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249 
<a name="l00251"></a><a class="code" href="classpion_1_1_pion_plugin.html#7ba5117df673127e886c4eac5968d725">00251</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> *getDestroyFunction(<span class="keywordtype">void</span>) {
<a name="l00252"></a>00252         <span class="keywordflow">return</span> (is_open() ? m_plugin_data-&gt;m_destroy_func : NULL);
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 
<a name="l00256"></a>00256     <span class="keywordtype">void</span> releaseData(<span class="keywordtype">void</span>);
<a name="l00257"></a>00257     
<a name="l00259"></a>00259     <span class="keywordtype">void</span> grabData(<span class="keyword">const</span> PionPlugin&amp; p);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     
<a name="l00262"></a>00262 <span class="keyword">private</span>:
<a name="l00263"></a>00263 
<a name="l00265"></a>00265     <span class="keyword">class </span>StaticEntryPoint
<a name="l00266"></a>00266     {
<a name="l00267"></a>00267     <span class="keyword">public</span>:
<a name="l00268"></a>00268         StaticEntryPoint(<span class="keyword">const</span> std::string&amp; name, <span class="keywordtype">void</span> *create, <span class="keywordtype">void</span> *destroy)
<a name="l00269"></a>00269             : m_plugin_name(name), m_create_func(create), m_destroy_func(destroy)
<a name="l00270"></a>00270             {}
<a name="l00271"></a>00271         std::string  m_plugin_name;
<a name="l00272"></a>00272         <span class="keywordtype">void</span> *       m_create_func;
<a name="l00273"></a>00273         <span class="keywordtype">void</span> *       m_destroy_func;
<a name="l00274"></a>00274     };
<a name="l00275"></a>00275 
<a name="l00277"></a>00277     <span class="keyword">typedef</span> std::list&lt;StaticEntryPoint&gt;     StaticEntryPointList;
<a name="l00278"></a>00278     
<a name="l00280"></a>00280     <span class="keyword">typedef</span> std::map&lt;std::string, PionPluginData*&gt;  PluginMap;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     
<a name="l00292"></a>00292     <span class="keyword">static</span> <span class="keywordtype">bool</span> findFile(std::string&amp; path_to_file, <span class="keyword">const</span> std::string&amp; name,                             
<a name="l00293"></a>00293                          <span class="keyword">const</span> std::string&amp; extension);
<a name="l00294"></a>00294     
<a name="l00305"></a>00305     <span class="keyword">static</span> <span class="keywordtype">bool</span> checkForFile(std::string&amp; final_path, <span class="keyword">const</span> std::string&amp; start_path,
<a name="l00306"></a>00306                              <span class="keyword">const</span> std::string&amp; name, <span class="keyword">const</span> std::string&amp; extension);
<a name="l00307"></a>00307     
<a name="l00314"></a>00314     <span class="keyword">static</span> <span class="keywordtype">void</span> openPlugin(<span class="keyword">const</span> std::string&amp; plugin_file,
<a name="l00315"></a>00315                            PionPluginData&amp; plugin_data);
<a name="l00316"></a>00316 
<a name="l00318"></a>00318     <span class="keyword">static</span> std::string getPluginName(<span class="keyword">const</span> std::string&amp; plugin_file);
<a name="l00319"></a>00319     
<a name="l00321"></a>00321     <span class="keyword">static</span> <span class="keywordtype">void</span> *loadDynamicLibrary(<span class="keyword">const</span> std::string&amp; plugin_file);
<a name="l00322"></a>00322     
<a name="l00324"></a>00324     <span class="keyword">static</span> <span class="keywordtype">void</span> closeDynamicLibrary(<span class="keywordtype">void</span> *lib_handle);
<a name="l00325"></a>00325     
<a name="l00327"></a>00327     <span class="keyword">static</span> <span class="keywordtype">void</span> *getLibrarySymbol(<span class="keywordtype">void</span> *lib_handle, <span class="keyword">const</span> std::string&amp; symbol);
<a name="l00328"></a>00328     
<a name="l00329"></a>00329     
<a name="l00331"></a>00331     <span class="keyword">static</span> <span class="keyword">const</span> std::string            PION_PLUGIN_CREATE;
<a name="l00332"></a>00332     
<a name="l00334"></a>00334     <span class="keyword">static</span> <span class="keyword">const</span> std::string            PION_PLUGIN_DESTROY;
<a name="l00335"></a>00335     
<a name="l00337"></a>00337     <span class="keyword">static</span> <span class="keyword">const</span> std::string            PION_PLUGIN_EXTENSION;
<a name="l00338"></a>00338     
<a name="l00340"></a>00340     <span class="keyword">static</span> <span class="keyword">const</span> std::string            PION_CONFIG_EXTENSION;
<a name="l00341"></a>00341     
<a name="l00343"></a>00343     <span class="keyword">static</span> std::vector&lt;std::string&gt;     m_plugin_dirs;
<a name="l00344"></a>00344     
<a name="l00346"></a>00346     <span class="keyword">static</span> PluginMap                    m_plugin_map;
<a name="l00347"></a>00347     
<a name="l00349"></a>00349     <span class="keyword">static</span> boost::mutex                 m_plugin_mutex;
<a name="l00350"></a>00350 
<a name="l00352"></a>00352     <span class="keyword">static</span> StaticEntryPointList         *m_entry_points_ptr;
<a name="l00353"></a>00353 
<a name="l00355"></a>00355     PionPluginData *                    m_plugin_data;
<a name="l00356"></a>00356 };
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 
<a name="l00363"></a>00363 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> InterfaceClassType&gt;
<a name="l00364"></a><a class="code" href="classpion_1_1_pion_plugin_ptr.html">00364</a> <span class="keyword">class </span><a class="code" href="classpion_1_1_pion_plugin_ptr.html">PionPluginPtr</a> :
<a name="l00365"></a>00365     <span class="keyword">public</span> PionPlugin
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367 <span class="keyword">protected</span>:
<a name="l00368"></a>00368     
<a name="l00370"></a><a class="code" href="classpion_1_1_pion_plugin_ptr.html#822eb1569012ef10edff30dcc7c6c7b3">00370</a>     <span class="keyword">typedef</span> InterfaceClassType* <a class="code" href="classpion_1_1_pion_plugin_ptr.html#822eb1569012ef10edff30dcc7c6c7b3">CreateObjectFunction</a>(<span class="keywordtype">void</span>);
<a name="l00371"></a>00371     
<a name="l00373"></a><a class="code" href="classpion_1_1_pion_plugin_ptr.html#d46fb6967592fcce7ab1ab047a1adefb">00373</a>     <span class="keyword">typedef</span> <span class="keywordtype">void</span> <a class="code" href="classpion_1_1_pion_plugin_ptr.html#d46fb6967592fcce7ab1ab047a1adefb">DestroyObjectFunction</a>(InterfaceClassType*);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     
<a name="l00376"></a>00376 <span class="keyword">public</span>:
<a name="l00377"></a>00377 
<a name="l00379"></a><a class="code" href="classpion_1_1_pion_plugin_ptr.html#bd34b7e791a8891b7b342b27df019f17">00379</a>     <a class="code" href="classpion_1_1_pion_plugin_ptr.html#bd34b7e791a8891b7b342b27df019f17">PionPluginPtr</a>(<span class="keywordtype">void</span>) : PionPlugin() {}
<a name="l00380"></a><a class="code" href="classpion_1_1_pion_plugin_ptr.html#f850b4536919c81701ee4a53d9b830f3">00380</a>     <span class="keyword">virtual</span> <a class="code" href="classpion_1_1_pion_plugin_ptr.html#f850b4536919c81701ee4a53d9b830f3">~PionPluginPtr</a>() {}
<a name="l00381"></a>00381     
<a name="l00383"></a><a class="code" href="classpion_1_1_pion_plugin_ptr.html#33d6a6266b62623a86ffcaf532e9526e">00383</a>     <a class="code" href="classpion_1_1_pion_plugin_ptr.html#bd34b7e791a8891b7b342b27df019f17">PionPluginPtr</a>(<span class="keyword">const</span> <a class="code" href="classpion_1_1_pion_plugin_ptr.html">PionPluginPtr</a>&amp; p) : PionPlugin(p) {}
<a name="l00384"></a>00384 
<a name="l00386"></a><a class="code" href="classpion_1_1_pion_plugin_ptr.html#ea2b4c2acfc51f5eae555708efc70143">00386</a>     <a class="code" href="classpion_1_1_pion_plugin_ptr.html">PionPluginPtr</a>&amp; <a class="code" href="classpion_1_1_pion_plugin_ptr.html#ea2b4c2acfc51f5eae555708efc70143">operator=</a>(<span class="keyword">const</span> <a class="code" href="classpion_1_1_pion_plugin_ptr.html">PionPluginPtr</a>&amp; p) { <a class="code" href="classpion_1_1_pion_plugin.html#7e3a19319057a40d65988cea3ad93977">grabData</a>(p); <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00387"></a>00387 
<a name="l00389"></a><a class="code" href="classpion_1_1_pion_plugin_ptr.html#d61b3cdbf944d544a9033843c3e3c22e">00389</a>     <span class="keyword">inline</span> InterfaceClassType *<a class="code" href="classpion_1_1_pion_plugin_ptr.html#d61b3cdbf944d544a9033843c3e3c22e">create</a>(<span class="keywordtype">void</span>) {
<a name="l00390"></a>00390         <a class="code" href="classpion_1_1_pion_plugin_ptr.html#822eb1569012ef10edff30dcc7c6c7b3">CreateObjectFunction</a> *create_func =
<a name="l00391"></a>00391             (<a class="code" href="classpion_1_1_pion_plugin_ptr.html#822eb1569012ef10edff30dcc7c6c7b3">CreateObjectFunction</a>*)(<a class="code" href="classpion_1_1_pion_plugin.html#5c6368504619782919c5771cce0af877">getCreateFunction</a>());
<a name="l00392"></a>00392         <span class="keywordflow">if</span> (create_func == NULL)
<a name="l00393"></a>00393             <span class="keywordflow">throw</span> PluginUndefinedException();
<a name="l00394"></a>00394         <span class="keywordflow">return</span> create_func();
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396     
<a name="l00398"></a><a class="code" href="classpion_1_1_pion_plugin_ptr.html#ba0794135fb4c5ab8f9b5d60afcb97a0">00398</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classpion_1_1_pion_plugin_ptr.html#ba0794135fb4c5ab8f9b5d60afcb97a0">destroy</a>(InterfaceClassType *object_ptr) {
<a name="l00399"></a>00399         <a class="code" href="classpion_1_1_pion_plugin_ptr.html#d46fb6967592fcce7ab1ab047a1adefb">DestroyObjectFunction</a> *destroy_func =
<a name="l00400"></a>00400             (<a class="code" href="classpion_1_1_pion_plugin_ptr.html#d46fb6967592fcce7ab1ab047a1adefb">DestroyObjectFunction</a>*)(<a class="code" href="classpion_1_1_pion_plugin.html#7ba5117df673127e886c4eac5968d725">getDestroyFunction</a>());
<a name="l00401"></a>00401         <span class="keywordflow">if</span> (destroy_func == NULL)
<a name="l00402"></a>00402             <span class="keywordflow">throw</span> PluginUndefinedException();
<a name="l00403"></a>00403         destroy_func(object_ptr);
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 };
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 
<a name="l00421"></a>00421 <span class="preprocessor">#ifdef PION_STATIC_LINKING</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span>
<a name="l00423"></a>00423 <span class="preprocessor">#define PION_DECLARE_PLUGIN(plugin_name)    \</span>
<a name="l00424"></a>00424 <span class="preprocessor">    class plugin_name;                      \</span>
<a name="l00425"></a>00425 <span class="preprocessor">    extern "C" plugin_name *pion_create_##plugin_name(void); \</span>
<a name="l00426"></a>00426 <span class="preprocessor">    extern "C" void pion_destroy_##plugin_name(plugin_name *plugin_ptr); \</span>
<a name="l00427"></a>00427 <span class="preprocessor">    static pion::StaticEntryPointHelper helper_##plugin_name(#plugin_name, pion_create_##plugin_name, pion_destroy_##plugin_name);</span>
<a name="l00428"></a>00428 <span class="preprocessor"></span>
<a name="l00430"></a>00430 <span class="keyword">class </span>StaticEntryPointHelper {
<a name="l00431"></a>00431 <span class="keyword">public</span>:
<a name="l00432"></a>00432     StaticEntryPointHelper(<span class="keyword">const</span> std::string&amp; name, <span class="keywordtype">void</span> *create, <span class="keywordtype">void</span> *destroy)
<a name="l00433"></a>00433     {
<a name="l00434"></a>00434         <a class="code" href="classpion_1_1_pion_plugin.html#08fab8eefa53f8f1770107a1ebd4e2ba">pion::PionPlugin::addStaticEntryPoint</a>(name, create, destroy);
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436 };
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 <span class="preprocessor">#else</span>
<a name="l00439"></a>00439 <span class="preprocessor"></span>
<a name="l00440"></a>00440 <span class="preprocessor">#define PION_DECLARE_PLUGIN(plugin_name)</span>
<a name="l00441"></a>00441 <span class="preprocessor"></span>
<a name="l00442"></a>00442 <span class="preprocessor">#endif</span>
<a name="l00443"></a>00443 <span class="preprocessor"></span>
<a name="l00444"></a>00444 }   <span class="comment">// end namespace pion</span>
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Aug 10 15:23:13 2010 for pion-net by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
