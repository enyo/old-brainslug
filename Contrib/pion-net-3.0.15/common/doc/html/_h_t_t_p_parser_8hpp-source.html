<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pion-net: net/include/pion/net/HTTPParser.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>net/include/pion/net/HTTPParser.hpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// ------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">// pion-net: a C++ framework for building lightweight HTTP interfaces</span>
<a name="l00003"></a>00003 <span class="comment">// ------------------------------------------------------------------</span>
<a name="l00004"></a>00004 <span class="comment">// Copyright (C) 2007-2008 Atomic Labs, Inc.  (http://www.atomiclabs.com)</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Distributed under the Boost Software License, Version 1.0.</span>
<a name="l00007"></a>00007 <span class="comment">// See http://www.boost.org/LICENSE_1_0.txt</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#ifndef __PION_HTTPPARSER_HEADER__</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor">#define __PION_HTTPPARSER_HEADER__</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;boost/noncopyable.hpp&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;boost/logic/tribool.hpp&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;pion/PionConfig.hpp&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;pion/PionLogger.hpp&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;pion/net/HTTPMessage.hpp&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="keyword">namespace </span>pion {    <span class="comment">// begin namespace pion</span>
<a name="l00022"></a>00022 <span class="keyword">namespace </span>net {     <span class="comment">// begin namespace net (Pion Network Library)</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">// forward declarations used for finishing HTTP messages</span>
<a name="l00025"></a>00025 <span class="keyword">class </span>HTTPRequest;
<a name="l00026"></a>00026 <span class="keyword">class </span>HTTPResponse;
<a name="l00027"></a>00027 
<a name="l00031"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html">00031</a> <span class="keyword">class </span>PION_NET_API HTTPParser :
<a name="l00032"></a>00032     <span class="keyword">private</span> boost::noncopyable
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keyword">public</span>:
<a name="l00036"></a>00036 
<a name="l00038"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#e50d68030598ba2a9f8475179edbf398">00038</a>     <span class="keyword">static</span> <span class="keyword">const</span> std::size_t        DEFAULT_CONTENT_MAX;
<a name="l00039"></a>00039 
<a name="l00047"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#776a8378586ece49d07f954fe5c7f9cd">00047</a>     HTTPParser(<span class="keyword">const</span> <span class="keywordtype">bool</span> is_request, std::size_t max_content_length = DEFAULT_CONTENT_MAX)
<a name="l00048"></a>00048         : m_logger(PION_GET_LOGGER(<span class="stringliteral">"pion.net.HTTPParser"</span>)), m_is_request(is_request),
<a name="l00049"></a>00049         m_read_ptr(NULL), m_read_end_ptr(NULL), m_message_parse_state(PARSE_START),
<a name="l00050"></a>00050         m_headers_parse_state(is_request ? PARSE_METHOD_START : PARSE_HTTP_VERSION_H),
<a name="l00051"></a>00051         m_chunked_content_parse_state(PARSE_CHUNK_SIZE_START), m_status_code(0),
<a name="l00052"></a>00052         m_bytes_content_remaining(0), m_bytes_content_read(0),
<a name="l00053"></a>00053         m_bytes_last_read(0), m_bytes_total_read(0),
<a name="l00054"></a>00054         m_max_content_length(max_content_length), m_save_raw_headers(false)
<a name="l00055"></a>00055     {}
<a name="l00056"></a>00056 
<a name="l00058"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#7741fab07c210b73994b031cb9e36658">00058</a>     <span class="keyword">virtual</span> ~HTTPParser() {}
<a name="l00059"></a>00059 
<a name="l00070"></a>00070     boost::tribool parse(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html">HTTPMessage</a>&amp; http_msg);
<a name="l00071"></a>00071 
<a name="l00083"></a>00083     boost::tribool parseMissingData(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html">HTTPMessage</a>&amp; http_msg, std::size_t len);
<a name="l00084"></a>00084 
<a name="l00090"></a>00090     <span class="keywordtype">void</span> finish(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html">HTTPMessage</a>&amp; http_msg) <span class="keyword">const</span>;
<a name="l00091"></a>00091 
<a name="l00098"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#24023fdadcccbf6deb536055a30f6cf0">00098</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> setReadBuffer(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, size_t len) {
<a name="l00099"></a>00099         m_read_ptr = ptr;
<a name="l00100"></a>00100         m_read_end_ptr = ptr + len;
<a name="l00101"></a>00101     }
<a name="l00102"></a>00102 
<a name="l00109"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#7e465ebe75416fa00586f1238e73c03b">00109</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> loadReadPosition(<span class="keyword">const</span> <span class="keywordtype">char</span> *&amp;read_ptr, <span class="keyword">const</span> <span class="keywordtype">char</span> *&amp;read_end_ptr)<span class="keyword"> const </span>{
<a name="l00110"></a>00110         read_ptr = m_read_ptr;
<a name="l00111"></a>00111         read_end_ptr = m_read_end_ptr;
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113 
<a name="l00123"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#285653cf89377a547dbefb452831fcf1">00123</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> checkPrematureEOF(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html">HTTPMessage</a>&amp; http_msg) {
<a name="l00124"></a>00124         <span class="keywordflow">if</span> (m_message_parse_state != PARSE_CONTENT_NO_LENGTH)
<a name="l00125"></a>00125             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00126"></a>00126         m_message_parse_state = PARSE_END;
<a name="l00127"></a>00127         http_msg.<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html#a813ba7a1dce7ccddc1cb7b908006f99">concatenateChunks</a>();
<a name="l00128"></a>00128         finish(http_msg);
<a name="l00129"></a>00129         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131 
<a name="l00133"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#8b940378889fc5aefa61ef871d2b6f00">00133</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> reset(<span class="keywordtype">void</span>) {
<a name="l00134"></a>00134         m_message_parse_state = PARSE_START;
<a name="l00135"></a>00135         m_headers_parse_state = (m_is_request ? PARSE_METHOD_START : PARSE_HTTP_VERSION_H);
<a name="l00136"></a>00136         m_chunked_content_parse_state = PARSE_CHUNK_SIZE_START;
<a name="l00137"></a>00137         m_status_code = 0;
<a name="l00138"></a>00138         m_status_message.erase();
<a name="l00139"></a>00139         m_method.erase();
<a name="l00140"></a>00140         m_resource.erase();
<a name="l00141"></a>00141         m_query_string.erase();
<a name="l00142"></a>00142         m_raw_headers.erase();
<a name="l00143"></a>00143         m_bytes_content_read = m_bytes_last_read = m_bytes_total_read = 0;
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145 
<a name="l00147"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#6190de184276528cabaf4648d59d3bc0">00147</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> eof(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_read_ptr == NULL || m_read_ptr &gt;= m_read_end_ptr; }
<a name="l00148"></a>00148 
<a name="l00150"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#97e86fabd35d3656f4aec5afd1075244">00150</a>     <span class="keyword">inline</span> std::size_t bytes_available(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (eof() ? 0 : (std::size_t)(m_read_end_ptr - m_read_ptr)); } 
<a name="l00151"></a>00151 
<a name="l00153"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#8b11737293e0a2b617f9b8715796515f">00153</a>     <span class="keyword">inline</span> std::size_t gcount(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_bytes_last_read; }
<a name="l00154"></a>00154 
<a name="l00156"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#231b404dd8250d202481d859a42680db">00156</a>     <span class="keyword">inline</span> std::size_t getTotalBytesRead(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_bytes_total_read; }
<a name="l00157"></a>00157 
<a name="l00159"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#cf91f5c10890a5a380e63db9eb38e272">00159</a>     <span class="keyword">inline</span> std::size_t getContentBytesRead(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_bytes_content_read; }
<a name="l00160"></a>00160 
<a name="l00162"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#07769e093105bca08076c76592e3be81">00162</a>     <span class="keyword">inline</span> std::size_t getMaxContentLength(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_max_content_length; }
<a name="l00163"></a>00163 
<a name="l00165"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#1b01ac96a5cc36086e6cb0d7d740499f">00165</a>     <span class="keyword">inline</span> <span class="keyword">const</span> std::string&amp; getRawHeaders(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_raw_headers; }
<a name="l00166"></a>00166 
<a name="l00168"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#0372501f88d0d2ae014f309a0b1d6036">00168</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> getSaveRawHeaders(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_save_raw_headers; }
<a name="l00169"></a>00169 
<a name="l00171"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#a7c90d4fc1b008b2118d3960a81b40de">00171</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> isParsingRequest(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_is_request; }
<a name="l00172"></a>00172 
<a name="l00174"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#4033f77e347241c7d02f8f35b3c30afe">00174</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> isParsingResponse(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ! m_is_request; }
<a name="l00175"></a>00175 
<a name="l00177"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#43fd3b6c38223c60ff88230a4a39d793">00177</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> setMaxContentLength(std::size_t n) { m_max_content_length = n; }
<a name="l00178"></a>00178 
<a name="l00180"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#32214ac2be1f412d8f4825ac096324b2">00180</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> resetMaxContentLength(<span class="keywordtype">void</span>) { m_max_content_length = DEFAULT_CONTENT_MAX; }
<a name="l00181"></a>00181 
<a name="l00183"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#b0620bde646e241a1341a52426862ab9">00183</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> setSaveRawHeaders(<span class="keywordtype">bool</span> b) { m_save_raw_headers = b; }
<a name="l00184"></a>00184 
<a name="l00186"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#ea89631a33380a2d326cbf3d928cd0f1">00186</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> setLogger(<a class="code" href="structpion_1_1_pion_logger.html">PionLogger</a> log_ptr) { m_logger = log_ptr; }
<a name="l00187"></a>00187 
<a name="l00189"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#2b737c4d77025a8213bb9d04a997677d">00189</a>     <span class="keyword">inline</span> <a class="code" href="structpion_1_1_pion_logger.html">PionLogger</a> getLogger(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> m_logger; }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00200"></a>00200     <span class="keyword">static</span> <span class="keywordtype">bool</span> contentTypeIsUrlEncoded(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_request.html">HTTPRequest</a>&amp; http_request);
<a name="l00201"></a>00201 
<a name="l00212"></a>00212     <span class="keyword">static</span> <span class="keywordtype">bool</span> parseURLEncoded(<a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#5dbaae025e754a4862957d17e2e7d9cf">HTTPTypes::QueryParams</a>&amp; dict,
<a name="l00213"></a>00213                                 <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keyword">const</span> std::size_t len);
<a name="l00214"></a>00214 
<a name="l00226"></a>00226     <span class="keyword">static</span> <span class="keywordtype">bool</span> parseCookieHeader(<a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#50fb5b59b0a6ad3eab753800cf78f4fb">HTTPTypes::CookieParams</a>&amp; dict,
<a name="l00227"></a>00227                                   <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keyword">const</span> std::size_t len,
<a name="l00228"></a>00228                                   <span class="keywordtype">bool</span> set_cookie_header);
<a name="l00229"></a>00229 
<a name="l00240"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#dffe57bbd26bf724ff0fb712504cf3b4">00240</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> parseCookieHeader(<a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#50fb5b59b0a6ad3eab753800cf78f4fb">HTTPTypes::CookieParams</a>&amp; dict,
<a name="l00241"></a>00241         <span class="keyword">const</span> std::string&amp; cookie_header, <span class="keywordtype">bool</span> set_cookie_header)
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243         <span class="keywordflow">return</span> parseCookieHeader(dict, cookie_header.c_str(), cookie_header.size(), set_cookie_header);
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 
<a name="l00255"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#6c98f37d882e62417ba3032e4673c2fd">00255</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> parseURLEncoded(<a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#5dbaae025e754a4862957d17e2e7d9cf">HTTPTypes::QueryParams</a>&amp; dict,
<a name="l00256"></a>00256         <span class="keyword">const</span> std::string&amp; query)
<a name="l00257"></a>00257     {
<a name="l00258"></a>00258         <span class="keywordflow">return</span> parseURLEncoded(dict, query.c_str(), query.size());
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 <span class="keyword">protected</span>:
<a name="l00263"></a>00263 
<a name="l00275"></a>00275     boost::tribool parseHeaders(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html">HTTPMessage</a>&amp; http_msg);
<a name="l00276"></a>00276 
<a name="l00282"></a>00282     <span class="keywordtype">void</span> updateMessageWithHeaderData(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html">HTTPMessage</a>&amp; http_msg) <span class="keyword">const</span>;
<a name="l00283"></a>00283 
<a name="l00295"></a>00295     boost::tribool finishHeaderParsing(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html">HTTPMessage</a>&amp; http_msg);
<a name="l00296"></a>00296 
<a name="l00307"></a>00307     boost::tribool parseChunks(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html#3f51e42afcccf433e7992b55b9797d13">HTTPMessage::ChunkCache</a>&amp; chunk_buffers);
<a name="l00308"></a>00308 
<a name="l00319"></a>00319     boost::tribool consumeContent(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html">HTTPMessage</a>&amp; http_msg);
<a name="l00320"></a>00320 
<a name="l00328"></a>00328     std::size_t consumeContentAsNextChunk(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html#3f51e42afcccf433e7992b55b9797d13">HTTPMessage::ChunkCache</a>&amp; chunk_buffers);
<a name="l00329"></a>00329 
<a name="l00335"></a>00335     <span class="keyword">static</span> <span class="keywordtype">void</span> computeMsgStatus(<a class="code" href="classpion_1_1net_1_1_h_t_t_p_message.html">HTTPMessage</a>&amp; http_msg, <span class="keywordtype">bool</span> msg_parsed_ok);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <span class="comment">// misc functions used by the parsing functions</span>
<a name="l00338"></a>00338     <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> isChar(<span class="keywordtype">int</span> c);
<a name="l00339"></a>00339     <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> isControl(<span class="keywordtype">int</span> c);
<a name="l00340"></a>00340     <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> isSpecial(<span class="keywordtype">int</span> c);
<a name="l00341"></a>00341     <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> isDigit(<span class="keywordtype">int</span> c);
<a name="l00342"></a>00342     <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> isHexDigit(<span class="keywordtype">int</span> c);
<a name="l00343"></a>00343     <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> isCookieAttribute(<span class="keyword">const</span> std::string&amp; name, <span class="keywordtype">bool</span> set_cookie_header);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 
<a name="l00347"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#f549a3b6cd8828e6d952a7e19801480f">00347</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        STATUS_MESSAGE_MAX;
<a name="l00348"></a>00348 
<a name="l00350"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#fa38a114f37ff980ec58f9da5c50b5db">00350</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        METHOD_MAX;
<a name="l00351"></a>00351 
<a name="l00353"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#4add415e3479ba4ffcfa4f3eeda356fa">00353</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        RESOURCE_MAX;
<a name="l00354"></a>00354 
<a name="l00356"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#672c8779fee025dcde92569b6db010f1">00356</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        QUERY_STRING_MAX;
<a name="l00357"></a>00357 
<a name="l00359"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#96da76034e15629e0f6e288ba288b406">00359</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        HEADER_NAME_MAX;
<a name="l00360"></a>00360 
<a name="l00362"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#7654ef1a379b7854c2d0490371733fbb">00362</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        HEADER_VALUE_MAX;
<a name="l00363"></a>00363 
<a name="l00365"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#0efa7c97831f9710d39adafdcf9edb02">00365</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        QUERY_NAME_MAX;
<a name="l00366"></a>00366 
<a name="l00368"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#2a671410687470793ee9ece4e0e2be7a">00368</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        QUERY_VALUE_MAX;
<a name="l00369"></a>00369 
<a name="l00371"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#acbdfeff150fc619bb43c82837a95a46">00371</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        COOKIE_NAME_MAX;
<a name="l00372"></a>00372 
<a name="l00374"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#7d9f1a3615cb1546eb571be4bc2055cc">00374</a>     <span class="keyword">static</span> <span class="keyword">const</span> boost::uint32_t        COOKIE_VALUE_MAX;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 
<a name="l00378"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#822abf338fe18ecd34729afcb1298498">00378</a>     <span class="keyword">mutable</span> <a class="code" href="structpion_1_1_pion_logger.html">PionLogger</a>                  m_logger;
<a name="l00379"></a>00379 
<a name="l00381"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#44ee011c9597863056d2166c58d23fe8">00381</a>     <span class="keyword">const</span> <span class="keywordtype">bool</span>                          m_is_request;
<a name="l00382"></a>00382 
<a name="l00384"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#e13ac336cf09a6897b589832ee6ab0da">00384</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> *                        m_read_ptr;
<a name="l00385"></a>00385 
<a name="l00387"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#1819fb391a103b5fdffb81169e2ebb8e">00387</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> *                        m_read_end_ptr;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="keyword">private</span>:
<a name="l00391"></a>00391 
<a name="l00393"></a>00393     <span class="keyword">enum</span> MessageParseState {
<a name="l00394"></a>00394         PARSE_START, PARSE_HEADERS, PARSE_CONTENT,
<a name="l00395"></a>00395         PARSE_CONTENT_NO_LENGTH, PARSE_CHUNKS, PARSE_END
<a name="l00396"></a>00396     };
<a name="l00397"></a>00397 
<a name="l00400"></a>00400     <span class="keyword">enum</span> HeadersParseState {
<a name="l00401"></a>00401         PARSE_METHOD_START, PARSE_METHOD, PARSE_URI_STEM, PARSE_URI_QUERY,
<a name="l00402"></a>00402         PARSE_HTTP_VERSION_H, PARSE_HTTP_VERSION_T_1, PARSE_HTTP_VERSION_T_2,
<a name="l00403"></a>00403         PARSE_HTTP_VERSION_P, PARSE_HTTP_VERSION_SLASH,
<a name="l00404"></a>00404         PARSE_HTTP_VERSION_MAJOR_START, PARSE_HTTP_VERSION_MAJOR,
<a name="l00405"></a>00405         PARSE_HTTP_VERSION_MINOR_START, PARSE_HTTP_VERSION_MINOR,
<a name="l00406"></a>00406         PARSE_STATUS_CODE_START, PARSE_STATUS_CODE, PARSE_STATUS_MESSAGE,
<a name="l00407"></a>00407         PARSE_EXPECTING_NEWLINE, PARSE_EXPECTING_CR,
<a name="l00408"></a>00408         PARSE_HEADER_WHITESPACE, PARSE_HEADER_START, PARSE_HEADER_NAME,
<a name="l00409"></a>00409         PARSE_SPACE_BEFORE_HEADER_VALUE, PARSE_HEADER_VALUE,
<a name="l00410"></a>00410         PARSE_EXPECTING_FINAL_NEWLINE, PARSE_EXPECTING_FINAL_CR
<a name="l00411"></a>00411     };
<a name="l00412"></a>00412 
<a name="l00415"></a>00415     <span class="keyword">enum</span> ChunkedContentParseState {
<a name="l00416"></a>00416         PARSE_CHUNK_SIZE_START, PARSE_CHUNK_SIZE, 
<a name="l00417"></a>00417         PARSE_EXPECTING_CR_AFTER_CHUNK_SIZE,
<a name="l00418"></a>00418         PARSE_EXPECTING_LF_AFTER_CHUNK_SIZE, PARSE_CHUNK, 
<a name="l00419"></a>00419         PARSE_EXPECTING_CR_AFTER_CHUNK, PARSE_EXPECTING_LF_AFTER_CHUNK,
<a name="l00420"></a>00420         PARSE_EXPECTING_FINAL_CR_AFTER_LAST_CHUNK, 
<a name="l00421"></a>00421         PARSE_EXPECTING_FINAL_LF_AFTER_LAST_CHUNK
<a name="l00422"></a>00422     };
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 
<a name="l00426"></a>00426     MessageParseState                   m_message_parse_state;
<a name="l00427"></a>00427 
<a name="l00429"></a>00429     HeadersParseState                   m_headers_parse_state;
<a name="l00430"></a>00430 
<a name="l00432"></a>00432     ChunkedContentParseState            m_chunked_content_parse_state;
<a name="l00433"></a>00433 
<a name="l00435"></a>00435     boost::uint16_t                     m_status_code;
<a name="l00436"></a>00436 
<a name="l00438"></a>00438     std::string                         m_status_message;
<a name="l00439"></a>00439 
<a name="l00441"></a>00441     std::string                         m_method;
<a name="l00442"></a>00442 
<a name="l00444"></a>00444     std::string                         m_resource;
<a name="l00445"></a>00445 
<a name="l00447"></a>00447     std::string                         m_query_string;
<a name="l00448"></a>00448 
<a name="l00450"></a>00450     std::string                         m_raw_headers;
<a name="l00451"></a>00451 
<a name="l00453"></a>00453     std::string                         m_header_name;
<a name="l00454"></a>00454 
<a name="l00456"></a>00456     std::string                         m_header_value;
<a name="l00457"></a>00457 
<a name="l00459"></a>00459     std::string                         m_chunk_size_str;
<a name="l00460"></a>00460 
<a name="l00462"></a>00462     std::size_t                         m_size_of_current_chunk;
<a name="l00463"></a>00463 
<a name="l00465"></a>00465     std::size_t                         m_bytes_read_in_current_chunk;
<a name="l00466"></a>00466 
<a name="l00468"></a>00468     std::size_t                         m_bytes_content_remaining;
<a name="l00469"></a>00469 
<a name="l00471"></a>00471     std::size_t                         m_bytes_content_read;
<a name="l00472"></a>00472 
<a name="l00474"></a>00474     std::size_t                         m_bytes_last_read;
<a name="l00475"></a>00475 
<a name="l00477"></a>00477     std::size_t                         m_bytes_total_read;
<a name="l00478"></a>00478 
<a name="l00480"></a>00480     std::size_t                         m_max_content_length;
<a name="l00481"></a>00481     
<a name="l00483"></a>00483     <span class="keywordtype">bool</span>                                m_save_raw_headers;
<a name="l00484"></a>00484 };
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 <span class="comment">// inline functions for HTTPParser</span>
<a name="l00488"></a>00488 
<a name="l00489"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#511861d764184e8145f38275e5c5fa6c">00489</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#511861d764184e8145f38275e5c5fa6c">HTTPParser::isChar</a>(<span class="keywordtype">int</span> c)
<a name="l00490"></a>00490 {
<a name="l00491"></a>00491     <span class="keywordflow">return</span>(c &gt;= 0 &amp;&amp; c &lt;= 127);
<a name="l00492"></a>00492 }
<a name="l00493"></a>00493 
<a name="l00494"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#ac52ae6d53099d73e9d6d65c0b525ff4">00494</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#ac52ae6d53099d73e9d6d65c0b525ff4">HTTPParser::isControl</a>(<span class="keywordtype">int</span> c)
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496     <span class="keywordflow">return</span>( (c &gt;= 0 &amp;&amp; c &lt;= 31) || c == 127);
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#77fef6b52fe81fb5a91f145f35ad91dd">00499</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#77fef6b52fe81fb5a91f145f35ad91dd">HTTPParser::isSpecial</a>(<span class="keywordtype">int</span> c)
<a name="l00500"></a>00500 {
<a name="l00501"></a>00501     <span class="keywordflow">switch</span> (c) {
<a name="l00502"></a>00502     <span class="keywordflow">case</span> <span class="charliteral">'('</span>: <span class="keywordflow">case</span> <span class="charliteral">')'</span>: <span class="keywordflow">case</span> <span class="charliteral">'&lt;'</span>: <span class="keywordflow">case</span> <span class="charliteral">'&gt;'</span>: <span class="keywordflow">case</span> <span class="charliteral">'@'</span>:
<a name="l00503"></a>00503     <span class="keywordflow">case</span> <span class="charliteral">','</span>: <span class="keywordflow">case</span> <span class="charliteral">';'</span>: <span class="keywordflow">case</span> <span class="charliteral">':'</span>: <span class="keywordflow">case</span> <span class="charliteral">'\\'</span>: <span class="keywordflow">case</span> <span class="charliteral">'"'</span>:
<a name="l00504"></a>00504     <span class="keywordflow">case</span> <span class="charliteral">'/'</span>: <span class="keywordflow">case</span> <span class="charliteral">'['</span>: <span class="keywordflow">case</span> <span class="charliteral">']'</span>: <span class="keywordflow">case</span> <span class="charliteral">'?'</span>: <span class="keywordflow">case</span> <span class="charliteral">'='</span>:
<a name="l00505"></a>00505     <span class="keywordflow">case</span> <span class="charliteral">'{'</span>: <span class="keywordflow">case</span> <span class="charliteral">'}'</span>: <span class="keywordflow">case</span> <span class="charliteral">' '</span>: <span class="keywordflow">case</span> <span class="charliteral">'\t'</span>:
<a name="l00506"></a>00506         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00507"></a>00507     <span class="keywordflow">default</span>:
<a name="l00508"></a>00508         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#6c976d53db596d817ca0b82c642154f8">00512</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#6c976d53db596d817ca0b82c642154f8">HTTPParser::isDigit</a>(<span class="keywordtype">int</span> c)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514     <span class="keywordflow">return</span>(c &gt;= <span class="charliteral">'0'</span> &amp;&amp; c &lt;= <span class="charliteral">'9'</span>);
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#a529564ec63aa8e8ec234a734d3202ef">00517</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#a529564ec63aa8e8ec234a734d3202ef">HTTPParser::isHexDigit</a>(<span class="keywordtype">int</span> c)
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519     <span class="keywordflow">return</span>((c &gt;= <span class="charliteral">'0'</span> &amp;&amp; c &lt;= <span class="charliteral">'9'</span>) || (c &gt;= <span class="charliteral">'a'</span> &amp;&amp; c &lt;= <span class="charliteral">'f'</span>) || (c &gt;= <span class="charliteral">'A'</span> &amp;&amp; c &lt;= <span class="charliteral">'F'</span>));
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a><a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#f95b22e50db62dd7475e308390e1bbfc">00522</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classpion_1_1net_1_1_h_t_t_p_parser.html#f95b22e50db62dd7475e308390e1bbfc">HTTPParser::isCookieAttribute</a>(<span class="keyword">const</span> std::string&amp; name, <span class="keywordtype">bool</span> set_cookie_header)
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524     <span class="keywordflow">return</span> (name.empty() || name[0] == <span class="charliteral">'$'</span> || (set_cookie_header &amp;&amp;
<a name="l00525"></a>00525         (name==<span class="stringliteral">"Comment"</span> || name==<span class="stringliteral">"Domain"</span> || name==<span class="stringliteral">"Max-Age"</span> || name==<span class="stringliteral">"Path"</span> || name==<span class="stringliteral">"Secure"</span> || name==<span class="stringliteral">"Version"</span> || name==<span class="stringliteral">"Expires"</span>)
<a name="l00526"></a>00526         ) );
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 }   <span class="comment">// end namespace net</span>
<a name="l00530"></a>00530 }   <span class="comment">// end namespace pion</span>
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Aug 10 15:23:13 2010 for pion-net by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
