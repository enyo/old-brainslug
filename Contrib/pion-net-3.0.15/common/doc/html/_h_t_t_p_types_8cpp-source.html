<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pion-net: net/src/HTTPTypes.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>net/src/HTTPTypes.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// ------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">// pion-net: a C++ framework for building lightweight HTTP interfaces</span>
<a name="l00003"></a>00003 <span class="comment">// ------------------------------------------------------------------</span>
<a name="l00004"></a>00004 <span class="comment">// Copyright (C) 2007-2008 Atomic Labs, Inc.  (http://www.atomiclabs.com)</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Distributed under the Boost Software License, Version 1.0.</span>
<a name="l00007"></a>00007 <span class="comment">// See http://www.boost.org/LICENSE_1_0.txt</span>
<a name="l00008"></a>00008 <span class="comment">//</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;boost/lexical_cast.hpp&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;boost/thread/mutex.hpp&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;pion/net/HTTPTypes.hpp&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;cstdio&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;ctime&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="keyword">namespace </span>pion {        <span class="comment">// begin namespace pion</span>
<a name="l00018"></a>00018 <span class="keyword">namespace </span>net {     <span class="comment">// begin namespace net (Pion Network Library)</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">// generic strings used by HTTP</span>
<a name="l00022"></a>00022 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#9b5c6762e018e8b7b3f572a623ea4b80">HTTPTypes::STRING_EMPTY</a>;
<a name="l00023"></a>00023 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#7b602c8be46471d7b9e8d7020a30f88a">HTTPTypes::STRING_CRLF</a>(<span class="stringliteral">"\x0D\x0A"</span>);
<a name="l00024"></a>00024 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#70ec14dd7fc70aaeb5cd4be47c5e6d82">HTTPTypes::STRING_HTTP_VERSION</a>(<span class="stringliteral">"HTTP/"</span>);
<a name="l00025"></a>00025 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#56df15d67b089d50ce1dddfcd7d4615d">HTTPTypes::HEADER_NAME_VALUE_DELIMITER</a>(<span class="stringliteral">": "</span>);
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="comment">// common HTTP header names</span>
<a name="l00028"></a>00028 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#4feead05389a838a5a604f7e3cf94e9e">HTTPTypes::HEADER_HOST</a>(<span class="stringliteral">"Host"</span>);
<a name="l00029"></a>00029 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#6a13c9edbf0df307a51f3b55ea3d94d1">HTTPTypes::HEADER_COOKIE</a>(<span class="stringliteral">"Cookie"</span>);
<a name="l00030"></a>00030 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#a1b08d60d033abc93d47d5835eedc774">HTTPTypes::HEADER_SET_COOKIE</a>(<span class="stringliteral">"Set-Cookie"</span>);
<a name="l00031"></a>00031 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#9a7717c3461f33185748024e8f6c80e9">HTTPTypes::HEADER_CONNECTION</a>(<span class="stringliteral">"Connection"</span>);
<a name="l00032"></a>00032 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#8f33040d28b5c62b488db9e5d3be1093">HTTPTypes::HEADER_CONTENT_TYPE</a>(<span class="stringliteral">"Content-Type"</span>);
<a name="l00033"></a>00033 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#3f6805b58da6ec85da81979d9039401d">HTTPTypes::HEADER_CONTENT_LENGTH</a>(<span class="stringliteral">"Content-Length"</span>);
<a name="l00034"></a>00034 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#8688d762034eaf97bd0d866a33631ec4">HTTPTypes::HEADER_CONTENT_LOCATION</a>(<span class="stringliteral">"Content-Location"</span>);
<a name="l00035"></a>00035 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#525b9ceadfb7dfc021feebee44a7828f">HTTPTypes::HEADER_CONTENT_ENCODING</a>(<span class="stringliteral">"Content-Encoding"</span>);
<a name="l00036"></a>00036 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#bd5359a83056f839f0a745741c6ac94c">HTTPTypes::HEADER_LAST_MODIFIED</a>(<span class="stringliteral">"Last-Modified"</span>);
<a name="l00037"></a>00037 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#076195c58857955934524e0834cf5c12">HTTPTypes::HEADER_IF_MODIFIED_SINCE</a>(<span class="stringliteral">"If-Modified-Since"</span>);
<a name="l00038"></a>00038 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#61e6f63778006a8c876b7b43e3b2155d">HTTPTypes::HEADER_TRANSFER_ENCODING</a>(<span class="stringliteral">"Transfer-Encoding"</span>);
<a name="l00039"></a>00039 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#eba74404000724011251783cbd1a2feb">HTTPTypes::HEADER_LOCATION</a>(<span class="stringliteral">"Location"</span>);
<a name="l00040"></a>00040 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#18c60d00005997db6c68a544a4b248c6">HTTPTypes::HEADER_AUTHORIZATION</a>(<span class="stringliteral">"Authorization"</span>);
<a name="l00041"></a>00041 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#ae468c748e56c76bc5eddcbe31dab23b">HTTPTypes::HEADER_REFERER</a>(<span class="stringliteral">"Referer"</span>);
<a name="l00042"></a>00042 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#c21e94a69dbdbeb7a67f00ac19bba07a">HTTPTypes::HEADER_USER_AGENT</a>(<span class="stringliteral">"User-Agent"</span>);
<a name="l00043"></a>00043 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#1eb6a52b21502838e61f6f802e52124c">HTTPTypes::HEADER_X_FORWARDED_FOR</a>(<span class="stringliteral">"X-Forwarded-For"</span>);
<a name="l00044"></a>00044 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#1f2543f5e7c06bd5cc48c52c69cb2c4a">HTTPTypes::HEADER_CLIENT_IP</a>(<span class="stringliteral">"Client-IP"</span>);
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">// common HTTP content types</span>
<a name="l00047"></a>00047 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#c17b90486c0395b256df156e9658acbb">HTTPTypes::CONTENT_TYPE_HTML</a>(<span class="stringliteral">"text/html"</span>);
<a name="l00048"></a>00048 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#77a0c7a64bab0e62c5852aa50db5c852">HTTPTypes::CONTENT_TYPE_TEXT</a>(<span class="stringliteral">"text/plain"</span>);
<a name="l00049"></a>00049 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#c8fe295aef523c4fa6f0c549ed1346e2">HTTPTypes::CONTENT_TYPE_XML</a>(<span class="stringliteral">"text/xml"</span>);
<a name="l00050"></a>00050 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#6b61079e753283d183bbd6a66b389882">HTTPTypes::CONTENT_TYPE_URLENCODED</a>(<span class="stringliteral">"application/x-www-form-urlencoded"</span>);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">// common HTTP request methods</span>
<a name="l00053"></a>00053 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#6bdfe60ab87ab8ccf14cf18c558b528a">HTTPTypes::REQUEST_METHOD_HEAD</a>(<span class="stringliteral">"HEAD"</span>);
<a name="l00054"></a>00054 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#8391a41cc1f5f635be4719fcc2b5cf7c">HTTPTypes::REQUEST_METHOD_GET</a>(<span class="stringliteral">"GET"</span>);
<a name="l00055"></a>00055 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#f76c0c088b7a2fc4d20cb935300978ad">HTTPTypes::REQUEST_METHOD_PUT</a>(<span class="stringliteral">"PUT"</span>);
<a name="l00056"></a>00056 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#696517b7b66d834383f5446f7f93bc3d">HTTPTypes::REQUEST_METHOD_POST</a>(<span class="stringliteral">"POST"</span>);
<a name="l00057"></a>00057 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#5ee27f0a059b0c5bbca05c3f2dae5457">HTTPTypes::REQUEST_METHOD_DELETE</a>(<span class="stringliteral">"DELETE"</span>);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="comment">// common HTTP response messages</span>
<a name="l00060"></a>00060 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#793063f5fd4235f800933ecaca6ebfbb">HTTPTypes::RESPONSE_MESSAGE_OK</a>(<span class="stringliteral">"OK"</span>);
<a name="l00061"></a>00061 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#e4aec942c899ff5dec9800884ab6a380">HTTPTypes::RESPONSE_MESSAGE_CREATED</a>(<span class="stringliteral">"Created"</span>);
<a name="l00062"></a>00062 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#24af0ec6b175b3a0cadcc57bfb1a40e7">HTTPTypes::RESPONSE_MESSAGE_NO_CONTENT</a>(<span class="stringliteral">"No Content"</span>);
<a name="l00063"></a>00063 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#f5eff4cceddbebf5f7877407a3850a2f">HTTPTypes::RESPONSE_MESSAGE_FOUND</a>(<span class="stringliteral">"Found"</span>);
<a name="l00064"></a>00064 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#b998b11283ebda86737491d5d61d40b7">HTTPTypes::RESPONSE_MESSAGE_UNAUTHORIZED</a>(<span class="stringliteral">"Unauthorized"</span>);
<a name="l00065"></a>00065 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#a5477b52ea2f1733fd98511567a245cf">HTTPTypes::RESPONSE_MESSAGE_FORBIDDEN</a>(<span class="stringliteral">"Forbidden"</span>);
<a name="l00066"></a>00066 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#297481a91336426a0c604078c590d851">HTTPTypes::RESPONSE_MESSAGE_NOT_FOUND</a>(<span class="stringliteral">"Not Found"</span>);
<a name="l00067"></a>00067 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#a5867f64e731862a9c9b7e76968c6853">HTTPTypes::RESPONSE_MESSAGE_METHOD_NOT_ALLOWED</a>(<span class="stringliteral">"Method Not Allowed"</span>);
<a name="l00068"></a>00068 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#523848b8db8505ee3e49256ba9201f09">HTTPTypes::RESPONSE_MESSAGE_NOT_MODIFIED</a>(<span class="stringliteral">"Not Modified"</span>);
<a name="l00069"></a>00069 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#ef94b4754a5f7a9a67194128f25ed9e5">HTTPTypes::RESPONSE_MESSAGE_BAD_REQUEST</a>(<span class="stringliteral">"Bad Request"</span>);
<a name="l00070"></a>00070 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#b4e36d0eaa41b18db4bf564ca4675068">HTTPTypes::RESPONSE_MESSAGE_SERVER_ERROR</a>(<span class="stringliteral">"Server Error"</span>);
<a name="l00071"></a>00071 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#bc1aa3de82963eb62b601bf4f12077fc">HTTPTypes::RESPONSE_MESSAGE_NOT_IMPLEMENTED</a>(<span class="stringliteral">"Not Implemented"</span>);
<a name="l00072"></a>00072 <span class="keyword">const</span> std::string   <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#86f5eba1cb8e4c20c5253efe2df81814">HTTPTypes::RESPONSE_MESSAGE_CONTINUE</a>(<span class="stringliteral">"Continue"</span>);
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="comment">// common HTTP response codes</span>
<a name="l00075"></a>00075 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#bc16a1757567189c5fbb339af9e64f1e">HTTPTypes::RESPONSE_CODE_OK</a> = 200;
<a name="l00076"></a>00076 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#20cff97b0e9a73406e29eb111f9ae31f">HTTPTypes::RESPONSE_CODE_CREATED</a> = 201;
<a name="l00077"></a>00077 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#65368b80ff65e56d37ade3a866886b63">HTTPTypes::RESPONSE_CODE_NO_CONTENT</a> = 204;
<a name="l00078"></a>00078 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#71d8700d1c002cf24618679ff1fbf61d">HTTPTypes::RESPONSE_CODE_FOUND</a> = 302;
<a name="l00079"></a>00079 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#e497e922e32b406295ef023a2981c2fb">HTTPTypes::RESPONSE_CODE_UNAUTHORIZED</a> = 401;
<a name="l00080"></a>00080 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#bf9443518f805b4f1b40ac4845a3ecc3">HTTPTypes::RESPONSE_CODE_FORBIDDEN</a> = 403;
<a name="l00081"></a>00081 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#169cd25ed4a82f3bd26ef025559fb585">HTTPTypes::RESPONSE_CODE_NOT_FOUND</a> = 404;
<a name="l00082"></a>00082 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#003a429425334bd0b1d154a1b09aceb8">HTTPTypes::RESPONSE_CODE_METHOD_NOT_ALLOWED</a> = 405;
<a name="l00083"></a>00083 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#4965b14ae5000d8315db3f5091b277ec">HTTPTypes::RESPONSE_CODE_NOT_MODIFIED</a> = 304;
<a name="l00084"></a>00084 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#ceaa6149083793e42b6a60de99a0dce2">HTTPTypes::RESPONSE_CODE_BAD_REQUEST</a> = 400;
<a name="l00085"></a>00085 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#976f8a5b4dd9cac0e1a712c2edf25642">HTTPTypes::RESPONSE_CODE_SERVER_ERROR</a> = 500;
<a name="l00086"></a>00086 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#648a231b23da6af51659e4c6b7645f3e">HTTPTypes::RESPONSE_CODE_NOT_IMPLEMENTED</a> = 501;
<a name="l00087"></a>00087 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#10be36f6fbb1ec042f91783a20eb992e">HTTPTypes::RESPONSE_CODE_CONTINUE</a> = 100;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="comment">// static member functions</span>
<a name="l00091"></a>00091     
<a name="l00092"></a><a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#559b18776be81864af2f64109c60ef0c">00092</a> <span class="keywordtype">bool</span> <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#559b18776be81864af2f64109c60ef0c">HTTPTypes::base64_decode</a>(<span class="keyword">const</span> std::string &amp;input, std::string &amp;output)
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> nop = -1; 
<a name="l00095"></a>00095     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> decoding_data[] = {
<a name="l00096"></a>00096         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop,
<a name="l00097"></a>00097         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop,
<a name="l00098"></a>00098         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop, 62, nop,nop,nop, 63,
<a name="l00099"></a>00099         52, 53, 54,  55,  56, 57, 58, 59,  60, 61,nop,nop, nop,nop,nop,nop,
<a name="l00100"></a>00100         nop, 0,  1,   2,   3,  4,  5,  6,   7,  8,  9, 10,  11, 12, 13, 14,
<a name="l00101"></a>00101         15, 16, 17,  18,  19, 20, 21, 22,  23, 24, 25,nop, nop,nop,nop,nop,
<a name="l00102"></a>00102         nop,26, 27,  28,  29, 30, 31, 32,  33, 34, 35, 36,  37, 38, 39, 40,
<a name="l00103"></a>00103         41, 42, 43,  44,  45, 46, 47, 48,  49, 50, 51,nop, nop,nop,nop,nop,
<a name="l00104"></a>00104         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop,
<a name="l00105"></a>00105         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop,
<a name="l00106"></a>00106         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop,
<a name="l00107"></a>00107         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop,
<a name="l00108"></a>00108         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop,
<a name="l00109"></a>00109         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop,
<a name="l00110"></a>00110         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop,
<a name="l00111"></a>00111         nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop, nop,nop,nop,nop
<a name="l00112"></a>00112         };
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> input_length=input.size();
<a name="l00115"></a>00115     <span class="keyword">const</span> <span class="keywordtype">char</span> * input_ptr = input.data();
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="comment">// allocate space for output string</span>
<a name="l00118"></a>00118     output.clear();
<a name="l00119"></a>00119     output.reserve(((input_length+2)/3)*4);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="comment">// for each 4-bytes sequence from the input, extract 4 6-bits sequences by droping first two bits</span>
<a name="l00122"></a>00122     <span class="comment">// and regenerate into 3 8-bits sequence</span>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;input_length;i++) {
<a name="l00125"></a>00125         <span class="keywordtype">char</span> base64code0;
<a name="l00126"></a>00126         <span class="keywordtype">char</span> base64code1;
<a name="l00127"></a>00127         <span class="keywordtype">char</span> base64code2 = 0;   <span class="comment">// initialized to 0 to suppress warnings</span>
<a name="l00128"></a>00128         <span class="keywordtype">char</span> base64code3;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         base64code0 = decoding_data[static_cast&lt;int&gt;(input_ptr[i])];
<a name="l00131"></a>00131         <span class="keywordflow">if</span>(base64code0==nop)            <span class="comment">// non base64 character</span>
<a name="l00132"></a>00132             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00133"></a>00133         <span class="keywordflow">if</span>(!(++i&lt;input_length)) <span class="comment">// we need at least two input bytes for first byte output</span>
<a name="l00134"></a>00134             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00135"></a>00135         base64code1 = decoding_data[static_cast&lt;int&gt;(input_ptr[i])];
<a name="l00136"></a>00136         <span class="keywordflow">if</span>(base64code1==nop)            <span class="comment">// non base64 character</span>
<a name="l00137"></a>00137             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         output += ((base64code0 &lt;&lt; 2) | ((base64code1 &gt;&gt; 4) &amp; 0x3));
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         <span class="keywordflow">if</span>(++i&lt;input_length) {
<a name="l00142"></a>00142             <span class="keywordtype">char</span> c = input_ptr[i];
<a name="l00143"></a>00143             <span class="keywordflow">if</span>(c ==<span class="charliteral">'='</span>) { <span class="comment">// padding , end of input</span>
<a name="l00144"></a>00144                 BOOST_ASSERT( (base64code1 &amp; 0x0f)==0);
<a name="l00145"></a>00145                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00146"></a>00146             }
<a name="l00147"></a>00147             base64code2 = decoding_data[static_cast&lt;int&gt;(input_ptr[i])];
<a name="l00148"></a>00148             <span class="keywordflow">if</span>(base64code2==nop)            <span class="comment">// non base64 character</span>
<a name="l00149"></a>00149                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151             output += ((base64code1 &lt;&lt; 4) &amp; 0xf0) | ((base64code2 &gt;&gt; 2) &amp; 0x0f);
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="keywordflow">if</span>(++i&lt;input_length) {
<a name="l00155"></a>00155             <span class="keywordtype">char</span> c = input_ptr[i];
<a name="l00156"></a>00156             <span class="keywordflow">if</span>(c ==<span class="charliteral">'='</span>) { <span class="comment">// padding , end of input</span>
<a name="l00157"></a>00157                 BOOST_ASSERT( (base64code2 &amp; 0x03)==0);
<a name="l00158"></a>00158                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00159"></a>00159             }
<a name="l00160"></a>00160             base64code3 = decoding_data[static_cast&lt;int&gt;(input_ptr[i])];
<a name="l00161"></a>00161             <span class="keywordflow">if</span>(base64code3==nop)            <span class="comment">// non base64 character</span>
<a name="l00162"></a>00162                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164             output += (((base64code2 &lt;&lt; 6) &amp; 0xc0) | base64code3 );
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00170"></a>00170 }
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#b1eb58d8d1e4e82acbb5cdd46011346f">00172</a> <span class="keywordtype">bool</span> <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#b1eb58d8d1e4e82acbb5cdd46011346f">HTTPTypes::base64_encode</a>(<span class="keyword">const</span> std::string &amp;input, std::string &amp;output)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> encoding_data[] = 
<a name="l00175"></a>00175         <span class="stringliteral">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> input_length=input.size();
<a name="l00178"></a>00178     <span class="keyword">const</span> <span class="keywordtype">char</span> * input_ptr = input.data();
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="comment">// allocate space for output string</span>
<a name="l00181"></a>00181     output.clear();
<a name="l00182"></a>00182     output.reserve(((input_length+2)/3)*4);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="comment">// for each 3-bytes sequence from the input, extract 4 6-bits sequences and encode using </span>
<a name="l00185"></a>00185     <span class="comment">// encoding_data lookup table.</span>
<a name="l00186"></a>00186     <span class="comment">// if input do not contains enough chars to complete 3-byte sequence,use pad char '=' </span>
<a name="l00187"></a>00187     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;input_length;i++) {
<a name="l00188"></a>00188         <span class="keywordtype">int</span> base64code0=0;
<a name="l00189"></a>00189         <span class="keywordtype">int</span> base64code1=0;
<a name="l00190"></a>00190         <span class="keywordtype">int</span> base64code2=0;
<a name="l00191"></a>00191         <span class="keywordtype">int</span> base64code3=0;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         base64code0 = (input_ptr[i] &gt;&gt; 2)  &amp; 0x3f;  <span class="comment">// 1-byte 6 bits</span>
<a name="l00194"></a>00194         output += encoding_data[base64code0];
<a name="l00195"></a>00195         base64code1 = (input_ptr[i] &lt;&lt; 4 ) &amp; 0x3f;  <span class="comment">// 1-byte 2 bits +</span>
<a name="l00196"></a>00196 
<a name="l00197"></a>00197         <span class="keywordflow">if</span> (++i &lt; input_length) {
<a name="l00198"></a>00198             base64code1 |= (input_ptr[i] &gt;&gt; 4) &amp; 0x0f; <span class="comment">// 2-byte 4 bits</span>
<a name="l00199"></a>00199             output += encoding_data[base64code1];
<a name="l00200"></a>00200             base64code2 = (input_ptr[i] &lt;&lt; 2) &amp; 0x3f;  <span class="comment">// 2-byte 4 bits + </span>
<a name="l00201"></a>00201 
<a name="l00202"></a>00202             <span class="keywordflow">if</span> (++i &lt; input_length) {
<a name="l00203"></a>00203                 base64code2 |= (input_ptr[i] &gt;&gt; 6) &amp; 0x03; <span class="comment">// 3-byte 2 bits</span>
<a name="l00204"></a>00204                 base64code3  = input_ptr[i] &amp; 0x3f;       <span class="comment">// 3-byte 6 bits</span>
<a name="l00205"></a>00205                 output += encoding_data[base64code2];
<a name="l00206"></a>00206                 output += encoding_data[base64code3];
<a name="l00207"></a>00207             } <span class="keywordflow">else</span> {
<a name="l00208"></a>00208                 output += encoding_data[base64code2];
<a name="l00209"></a>00209                 output += <span class="charliteral">'='</span>;
<a name="l00210"></a>00210             }
<a name="l00211"></a>00211         } <span class="keywordflow">else</span> {
<a name="l00212"></a>00212             output += encoding_data[base64code1];
<a name="l00213"></a>00213             output += <span class="charliteral">'='</span>;
<a name="l00214"></a>00214             output += <span class="charliteral">'='</span>;
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#5fd6150827eec9be14ea0a76176f4d90">00221</a> std::string <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#5fd6150827eec9be14ea0a76176f4d90">HTTPTypes::url_decode</a>(<span class="keyword">const</span> std::string&amp; str)
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223     <span class="keywordtype">char</span> decode_buf[3];
<a name="l00224"></a>00224     std::string result;
<a name="l00225"></a>00225     result.reserve(str.size());
<a name="l00226"></a>00226     
<a name="l00227"></a>00227     <span class="keywordflow">for</span> (std::string::size_type pos = 0; pos &lt; str.size(); ++pos) {
<a name="l00228"></a>00228         <span class="keywordflow">switch</span>(str[pos]) {
<a name="l00229"></a>00229         <span class="keywordflow">case</span> <span class="charliteral">'+'</span>:
<a name="l00230"></a>00230             <span class="comment">// convert to space character</span>
<a name="l00231"></a>00231             result += <span class="charliteral">' '</span>;
<a name="l00232"></a>00232             <span class="keywordflow">break</span>;
<a name="l00233"></a>00233         <span class="keywordflow">case</span> <span class="charliteral">'%'</span>:
<a name="l00234"></a>00234             <span class="comment">// decode hexidecimal value</span>
<a name="l00235"></a>00235             <span class="keywordflow">if</span> (pos + 2 &lt; str.size()) {
<a name="l00236"></a>00236                 decode_buf[0] = str[++pos];
<a name="l00237"></a>00237                 decode_buf[1] = str[++pos];
<a name="l00238"></a>00238                 decode_buf[2] = <span class="charliteral">'\0'</span>;
<a name="l00239"></a>00239                 result += static_cast&lt;char&gt;( strtol(decode_buf, 0, 16) );
<a name="l00240"></a>00240             } <span class="keywordflow">else</span> {
<a name="l00241"></a>00241                 <span class="comment">// recover from error by not decoding character</span>
<a name="l00242"></a>00242                 result += <span class="charliteral">'%'</span>;
<a name="l00243"></a>00243             }
<a name="l00244"></a>00244             <span class="keywordflow">break</span>;
<a name="l00245"></a>00245         <span class="keywordflow">default</span>:
<a name="l00246"></a>00246             <span class="comment">// character does not need to be escaped</span>
<a name="l00247"></a>00247             result += str[pos];
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249     };
<a name="l00250"></a>00250     
<a name="l00251"></a>00251     <span class="keywordflow">return</span> result;
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253     
<a name="l00254"></a><a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#be6604ab953f8eef73799772a107a453">00254</a> std::string <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#be6604ab953f8eef73799772a107a453">HTTPTypes::url_encode</a>(<span class="keyword">const</span> std::string&amp; str)
<a name="l00255"></a>00255 {
<a name="l00256"></a>00256     <span class="keywordtype">char</span> encode_buf[4];
<a name="l00257"></a>00257     std::string result;
<a name="l00258"></a>00258     encode_buf[0] = <span class="charliteral">'%'</span>;
<a name="l00259"></a>00259     result.reserve(str.size());
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <span class="comment">// character selection for this algorithm is based on the following url:</span>
<a name="l00262"></a>00262     <span class="comment">// http://www.blooberry.com/indexdot/html/topics/urlencoding.htm</span>
<a name="l00263"></a>00263     
<a name="l00264"></a>00264     <span class="keywordflow">for</span> (std::string::size_type pos = 0; pos &lt; str.size(); ++pos) {
<a name="l00265"></a>00265         <span class="keywordflow">switch</span>(str[pos]) {
<a name="l00266"></a>00266         <span class="keywordflow">default</span>:
<a name="l00267"></a>00267             <span class="keywordflow">if</span> (str[pos] &gt; 32 &amp;&amp; str[pos] &lt; 127) {
<a name="l00268"></a>00268                 <span class="comment">// character does not need to be escaped</span>
<a name="l00269"></a>00269                 result += str[pos];
<a name="l00270"></a>00270                 <span class="keywordflow">break</span>;
<a name="l00271"></a>00271             }
<a name="l00272"></a>00272             <span class="comment">// else pass through to next case</span>
<a name="l00273"></a>00273         <span class="keywordflow">case</span> <span class="charliteral">' '</span>:   
<a name="l00274"></a>00274         <span class="keywordflow">case</span> <span class="charliteral">'$'</span>: <span class="keywordflow">case</span> <span class="charliteral">'&amp;'</span>: <span class="keywordflow">case</span> <span class="charliteral">'+'</span>: <span class="keywordflow">case</span> <span class="charliteral">','</span>: <span class="keywordflow">case</span> <span class="charliteral">'/'</span>: <span class="keywordflow">case</span> <span class="charliteral">':'</span>:
<a name="l00275"></a>00275         <span class="keywordflow">case</span> <span class="charliteral">';'</span>: <span class="keywordflow">case</span> <span class="charliteral">'='</span>: <span class="keywordflow">case</span> <span class="charliteral">'?'</span>: <span class="keywordflow">case</span> <span class="charliteral">'@'</span>: <span class="keywordflow">case</span> <span class="charliteral">'"'</span>: <span class="keywordflow">case</span> <span class="charliteral">'&lt;'</span>:
<a name="l00276"></a>00276         <span class="keywordflow">case</span> <span class="charliteral">'&gt;'</span>: <span class="keywordflow">case</span> <span class="charliteral">'#'</span>: <span class="keywordflow">case</span> <span class="charliteral">'%'</span>: <span class="keywordflow">case</span> <span class="charliteral">'{'</span>: <span class="keywordflow">case</span> <span class="charliteral">'}'</span>: <span class="keywordflow">case</span> <span class="charliteral">'|'</span>:
<a name="l00277"></a>00277         <span class="keywordflow">case</span> <span class="charliteral">'\\'</span>: <span class="keywordflow">case</span> <span class="charliteral">'^'</span>: <span class="keywordflow">case</span> <span class="charliteral">'~'</span>: <span class="keywordflow">case</span> <span class="charliteral">'['</span>: <span class="keywordflow">case</span> <span class="charliteral">']'</span>: <span class="keywordflow">case</span> <span class="charliteral">'`'</span>:
<a name="l00278"></a>00278             <span class="comment">// the character needs to be encoded</span>
<a name="l00279"></a>00279             sprintf(encode_buf+1, <span class="stringliteral">"%.2X"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(str[pos]));
<a name="l00280"></a>00280             result += encode_buf;
<a name="l00281"></a>00281             <span class="keywordflow">break</span>;
<a name="l00282"></a>00282         }
<a name="l00283"></a>00283     };
<a name="l00284"></a>00284     
<a name="l00285"></a>00285     <span class="keywordflow">return</span> result;
<a name="l00286"></a>00286 }   
<a name="l00287"></a>00287 
<a name="l00288"></a><a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#d2c33324b89782d9302e988b1cc8e96a">00288</a> std::string <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#d2c33324b89782d9302e988b1cc8e96a">HTTPTypes::get_date_string</a>(<span class="keyword">const</span> time_t t)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290     <span class="comment">// use mutex since time functions are normally not thread-safe</span>
<a name="l00291"></a>00291     <span class="keyword">static</span> boost::mutex time_mutex;
<a name="l00292"></a>00292     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *TIME_FORMAT = <span class="stringliteral">"%a, %d %b %Y %H:%M:%S GMT"</span>;
<a name="l00293"></a>00293     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TIME_BUF_SIZE = 100;
<a name="l00294"></a>00294     <span class="keywordtype">char</span> time_buf[TIME_BUF_SIZE+1];
<a name="l00295"></a>00295 
<a name="l00296"></a>00296     boost::mutex::scoped_lock time_lock(time_mutex);
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (strftime(time_buf, TIME_BUF_SIZE, TIME_FORMAT, gmtime(&amp;t)) == 0)
<a name="l00298"></a>00298         time_buf[0] = <span class="charliteral">'\0'</span>; <span class="comment">// failed; resulting buffer is indeterminate</span>
<a name="l00299"></a>00299     time_lock.unlock();
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="keywordflow">return</span> std::string(time_buf);
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#f96aa36470cd96e4a52cc68fb076c021">00304</a> std::string <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#f96aa36470cd96e4a52cc68fb076c021">HTTPTypes::make_query_string</a>(<span class="keyword">const</span> QueryParams&amp; query_params)
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306     std::string query_string;
<a name="l00307"></a>00307     <span class="keywordflow">for</span> (QueryParams::const_iterator i = query_params.begin(); i != query_params.end(); ++i) {
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (i != query_params.begin())
<a name="l00309"></a>00309             query_string += <span class="charliteral">'&amp;'</span>;
<a name="l00310"></a>00310         query_string += <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#be6604ab953f8eef73799772a107a453">url_encode</a>(i-&gt;first);
<a name="l00311"></a>00311         query_string += <span class="charliteral">'='</span>;
<a name="l00312"></a>00312         query_string += <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#be6604ab953f8eef73799772a107a453">url_encode</a>(i-&gt;second);
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314     <span class="keywordflow">return</span> query_string;
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a><a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#c6ded1c71347e3a865c92a54ff546098">00317</a> std::string <a class="code" href="structpion_1_1net_1_1_h_t_t_p_types.html#c6ded1c71347e3a865c92a54ff546098">HTTPTypes::make_set_cookie_header</a>(<span class="keyword">const</span> std::string&amp; name,
<a name="l00318"></a>00318                                               <span class="keyword">const</span> std::string&amp; value,
<a name="l00319"></a>00319                                               <span class="keyword">const</span> std::string&amp; path,
<a name="l00320"></a>00320                                               <span class="keyword">const</span> <span class="keywordtype">bool</span> has_max_age,
<a name="l00321"></a>00321                                               <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> max_age)
<a name="l00322"></a>00322 {
<a name="l00323"></a>00323     std::string set_cookie_header(name);
<a name="l00324"></a>00324     set_cookie_header += <span class="stringliteral">"=\""</span>;
<a name="l00325"></a>00325     set_cookie_header += value;
<a name="l00326"></a>00326     set_cookie_header += <span class="stringliteral">"\"; Version=\"1\""</span>;
<a name="l00327"></a>00327     <span class="keywordflow">if</span> (! path.empty()) {
<a name="l00328"></a>00328         set_cookie_header += <span class="stringliteral">"; Path=\""</span>;
<a name="l00329"></a>00329         set_cookie_header += path;
<a name="l00330"></a>00330         set_cookie_header += <span class="charliteral">'\"'</span>;
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332     <span class="keywordflow">if</span> (has_max_age) {
<a name="l00333"></a>00333         set_cookie_header += <span class="stringliteral">"; Max-Age=\""</span>;
<a name="l00334"></a>00334         set_cookie_header += boost::lexical_cast&lt;std::string&gt;(max_age);
<a name="l00335"></a>00335         set_cookie_header += <span class="charliteral">'\"'</span>;
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337     <span class="keywordflow">return</span> set_cookie_header;
<a name="l00338"></a>00338 }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     
<a name="l00341"></a>00341 }   <span class="comment">// end namespace net</span>
<a name="l00342"></a>00342 }   <span class="comment">// end namespace pion</span>
<a name="l00343"></a>00343 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Aug 10 15:23:13 2010 for pion-net by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
